\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Foundations of Data Science I},
            pdfauthor={Jesse Lecy},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Foundations of Data Science I}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Jesse Lecy}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{28 July, 2018}

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\usepackage{amsthm}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}[chapter]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{corollary}{Corollary}[chapter]
\newtheorem{proposition}{Proposition}[chapter]
\theoremstyle{definition}
\newtheorem{example}{Example}[chapter]
\theoremstyle{definition}
\newtheorem{exercise}{Exercise}[chapter]
\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem*{solution}{Solution}
\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{prerequisites}{%
\chapter{Prerequisites}\label{prerequisites}}

This is a \emph{sample} book written in \textbf{Markdown}. You can use
anything that Pandoc's Markdown supports, e.g., a math equation
\(a^2 + b^2 = c^2\).

The \textbf{bookdown} package can be installed from CRAN or Github:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"bookdown"}\NormalTok{)}
\CommentTok{# or the development version}
\CommentTok{# devtools::install_github("rstudio/bookdown")}
\end{Highlighting}
\end{Shaded}

Remember each Rmd file contains one and only one chapter, and a chapter
is defined by the first-level heading \texttt{\#}.

To compile this example to PDF, you need XeLaTeX. You are recommended to
install TinyTeX (which includes XeLaTeX):
\url{https://yihui.name/tinytex/}.

\hypertarget{introduction-to-r}{%
\chapter{Introduction to R}\label{introduction-to-r}}

This lecture introduces you to basic operations when you first start
using R such as navigation, the object-oriented framework, loading a
package, and creating some data vectors.

\hypertarget{navigation}{%
\section{Navigation}\label{navigation}}

You need to know a few operations to help you maneuver the R work
environment, such as listing objects (datasets and functions) that are
active, changing your working directory, listing available files, and
finding help.

\hypertarget{setting-your-working-directory}{%
\subsection{Setting Your Working
Directory}\label{setting-your-working-directory}}

When you are ready to load data, R needs to know where to look for your
files. You can check what is avaiable in the current directory
(i.e.~folder) by asking to list all of the current files using
\textbf{dir()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dir}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

If the file that you need is located in a different folder, you can
change directories easily in R Studio by Session -\textgreater{} Set
working director -\textgreater{} Choose directory (or Ctrl + Shift + H).

If you are writing a script, you want to keep track of this step so that
it can be reproduced. Use the function \textbf{get.wd()} to check your
current working directory, and \textbf{set.wd()} to change. You need to
specify your path as an argument to this function, such as.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setwd}\NormalTok{( }\StringTok{"C:/user/projects/financial model"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

NOTE! R uses unix style notation with forward slashes, so if you copy
and paste from Windows it will look like this, with back slashes:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setwd}\NormalTok{( }\StringTok{"C:\textbackslash{}user\textbackslash{}projects}\CharTok{\textbackslash{}f}\StringTok{inancial model"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

You will need to change them around for it to work.

It is best to save all of your steps in your scripts so that the
analysis can be reproduced by yourself or others. In some cases you are
doing exploratory or summary work, and you may want to find a file a
quickly. You can use the \textbf{file.choose()} function to open a GUI
to select your file directly. This function is used as an argument
inside of a load data function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my.dat <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{( }\KeywordTok{file.choose}\NormalTok{() )}
\end{Highlighting}
\end{Shaded}

\hypertarget{commenting-code}{%
\section{Commenting Code}\label{commenting-code}}

Most computer languages have a special character that is used to
``comment out'' lines so that it is not run by the program. It is used
for two important purposes. First, we can add text to document our
functions and it will not interfere with the program. And two, we can
use it to run a program while ignoring some of the code, often for
debugging purposes.

The \textbf{\#} hash tag is used for comments in R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{##==============================================}
\CommentTok{##}
\CommentTok{##  Here is some documentation for this script}
\CommentTok{##}
\CommentTok{##==============================================}

\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}

\KeywordTok{sum}\NormalTok{( x )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 55
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# y <- 1:25     # not run}

\CommentTok{# sum( y )      # not run}
\end{Highlighting}
\end{Shaded}

\hypertarget{help}{%
\section{Help}\label{help}}

You will use the help functions frequently to figure out what arguments
and values are needed for specific functions. Because R is very
customizable, you will find that many functions have several or dozens
of arguments, and it is difficult to remember the correct syntax and
values. But don't worry, to look them up all you need is the function
name and a call for help:

\begin{quote}
help( dotchart ) \# opens an external helpfile
\end{quote}

If you just need to remind yourself which arguments are defined in a
function, you can use the \emph{args()} command:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{args}\NormalTok{( dotchart )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## function (x, labels = NULL, groups = NULL, gdata = NULL, cex = par("cex"), 
##     pt.cex = cex, pch = 21, gpch = 21, bg = par("bg"), color = par("fg"), 
##     gcolor = par("fg"), lcolor = "gray", xlim = range(x[is.finite(x)]), 
##     main = NULL, xlab = NULL, ylab = NULL, ...) 
## NULL
\end{verbatim}

If you can't recall a function name, you can list all of the functions
from a specific package as follows:

\begin{quote}
help( package=``stats'' ) \# lists all functions in stats package
\end{quote}

\hypertarget{install-programs-packages}{%
\section{Install Programs (packages)}\label{install-programs-packages}}

When you open R by default it will launch a core set of programs, called
``packages'' in R speak, that are use for most data operations. To see
which packages are currently active use the \textbf{search()} function.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{search}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] ".GlobalEnv"        "package:ggplot2"   "package:scales"   
##  [4] "package:reshape2"  "package:tidyr"     "package:bindrcpp" 
##  [7] "package:maps"      "package:dplyr"     "package:pander"   
## [10] "package:Lahman"    "package:bookdown"  "package:stats"    
## [13] "package:graphics"  "package:grDevices" "package:utils"    
## [16] "package:datasets"  "package:methods"   "Autoloads"        
## [19] "package:base"
\end{verbatim}

These programs manage the basic data operations, run the core graphics
engine, and give you basic statistical methods.

The real magic for R comes from the over 7,000 contributed packages
available on the CRAN: \url{https://cran.r-project.org/web/views/}

A package consists of custom functions and datasets that are generated
by users. They are \emph{packaged} together so that they can be shared
with others. A package also includes documentation that describes each
function, defines all of the arguments, and documents any datasets that
are included.

If you know a package name, it is easy to install. In R Studio you can
select Tools -\textgreater{} Install Packages and a list of available
packages will be generated. But it is easier to use the
\textbf{install.packages()} command. We will use the Lahman Package in
this course, so let's install that now.

\textbf{Description} \emph{This package provides the tables from Sean
Lahman's Baseball Database as a set of R data.frames. It uses the data
on pitching, hitting and fielding performance and other tables from 1871
through 2013, as recorded in the 2014 version of the database.}

See the documentation here:
\url{https://cran.r-project.org/web/packages/Lahman/Lahman.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{( }\StringTok{"Lahman"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

You will be asked to select a ``mirror''. In R speak this just means the
server from which you will download the package (choose anything
nearby). R is a community of developers and universities that create
code and maintain the infrastructure. A couple of dozen universities
around the world host servers that contain copies of the R packages so
that they can be easily accessed everywhere.

If the package is successfully installed you will get a message similar
to this:

\begin{quote}
package `Lahman' successfully unpacked and MD5 sums checked
\end{quote}

Once a new program is installed you can now open (``load'' in R speak)
the package using the \textbf{library()} command:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( }\StringTok{"Lahman"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

If you now type \textbf{search()} you can see that Lahman has been added
to the list of active programs. We can now access all of the functions
and data that are available in the Lahman package.

\hypertarget{accessing-built-in-datasets-in-r}{%
\section{Accessing Built-In Datasets in
R}\label{accessing-built-in-datasets-in-r}}

One nice feature of R is that is comes with a bunch of built-in datasets
that have been contributed by users are are loaded automatically. You
can see the list of available datasets by typing:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

This will list all of the default datasets in core R packages. If you
want to see all of the datasets available in installed packages as well
use:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{( }\DataTypeTok{package =} \KeywordTok{.packages}\NormalTok{(}\DataTypeTok{all.available =} \OtherTok{TRUE}\NormalTok{) )}
\end{Highlighting}
\end{Shaded}

\hypertarget{basic-data-operations}{%
\subsection{Basic Data Operations}\label{basic-data-operations}}

Let's ignore the underlying data structure right now and look at some
ways that we might interact with data.

We will use the \textbf{USArrests} dataset available in the core files.

To access the data we need to load it into working memory. Anything that
is active in R will be listed in the environment, which you can check
using the \textbf{ls()} command. We will load the dataset using the
\textbf{data()} command.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{remove}\NormalTok{( }\DataTypeTok{list=}\KeywordTok{ls}\NormalTok{() )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ls}\NormalTok{() }\CommentTok{# nothing currently available}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## character(0)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{( }\StringTok{"USArrests"}\NormalTok{ )}

\KeywordTok{ls}\NormalTok{() }\CommentTok{# data is now avaible for use}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "USArrests"
\end{verbatim}

Now that we have loaded a dataset, we can start to access the variables
and analyze relationships. Let's get to know our dataset.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{( USArrests )  }\CommentTok{# what variables do you have?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Murder"   "Assault"  "UrbanPop" "Rape"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{row.names}\NormalTok{( USArrests )   }\CommentTok{# what are the obsevations (rows) in our data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Alabama"        "Alaska"         "Arizona"        "Arkansas"      
##  [5] "California"     "Colorado"       "Connecticut"    "Delaware"      
##  [9] "Florida"        "Georgia"        "Hawaii"         "Idaho"         
## [13] "Illinois"       "Indiana"        "Iowa"           "Kansas"        
## [17] "Kentucky"       "Louisiana"      "Maine"          "Maryland"      
## [21] "Massachusetts"  "Michigan"       "Minnesota"      "Mississippi"   
## [25] "Missouri"       "Montana"        "Nebraska"       "Nevada"        
## [29] "New Hampshire"  "New Jersey"     "New Mexico"     "New York"      
## [33] "North Carolina" "North Dakota"   "Ohio"           "Oklahoma"      
## [37] "Oregon"         "Pennsylvania"   "Rhode Island"   "South Carolina"
## [41] "South Dakota"   "Tennessee"      "Texas"          "Utah"          
## [45] "Vermont"        "Virginia"       "Washington"     "West Virginia" 
## [49] "Wisconsin"      "Wyoming"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{( USArrests )   }\CommentTok{# how many observations are there?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{( USArrests )    }\CommentTok{# a quick way to see rows and columns - the dimensions of the dataset}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 50  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{( USArrests )   }\CommentTok{# summary statistics of variables}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Murder          Assault         UrbanPop          Rape      
##  Min.   : 0.800   Min.   : 45.0   Min.   :32.00   Min.   : 7.30  
##  1st Qu.: 4.075   1st Qu.:109.0   1st Qu.:54.50   1st Qu.:15.07  
##  Median : 7.250   Median :159.0   Median :66.00   Median :20.10  
##  Mean   : 7.788   Mean   :170.8   Mean   :65.54   Mean   :21.23  
##  3rd Qu.:11.250   3rd Qu.:249.0   3rd Qu.:77.75   3rd Qu.:26.18  
##  Max.   :17.400   Max.   :337.0   Max.   :91.00   Max.   :46.00
\end{verbatim}

We can see that the dataset consists of four variables: Murder, Assault,
UrbanPop, and Rape. We also see that our unit of analysis is the state.
But where does the data come from, and how are these variables measured?

To see the documentation for a specific dataset you will need to use the
\textbf{help()} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{help}\NormalTok{( }\StringTok{"USArrests"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

We get valuable information about the source and metrics:

\textbf{Description} \emph{This data set contains statistics, in arrests
per 100,000 residents for assault, murder, and rape in each of the 50 US
states in 1973. Also given is the percent of the population living in
urban areas.}

\textbf{Format} \emph{A data frame with 50 observations on 4 variables.}

\emph{{[},1{]} Murder numeric Murder arrests (per 100,000)}
\emph{{[},2{]} Assault numeric Assault arrests (per 100,000)}
\emph{{[},3{]} UrbanPop numeric Percent urban population} \emph{{[},4{]}
Rape numeric Rape arrests (per 100,000)}

To access a specific variable inside of a dataset, you will use the
\emph{\$} operator between the dataset name and the variable name:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{( USArrests}\OperatorTok{$}\NormalTok{Murder )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.800   4.075   7.250   7.788  11.250  17.400
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{( USArrests}\OperatorTok{$}\NormalTok{Assault )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    45.0   109.0   159.0   170.8   249.0   337.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Is there a relationship between urban density and crime?}

\KeywordTok{plot}\NormalTok{( USArrests}\OperatorTok{$}\NormalTok{UrbanPop, USArrests}\OperatorTok{$}\NormalTok{Murder )}
\KeywordTok{abline}\NormalTok{( }\KeywordTok{lm}\NormalTok{( USArrests}\OperatorTok{$}\NormalTok{Murder }\OperatorTok{~}\StringTok{ }\NormalTok{USArrests}\OperatorTok{$}\NormalTok{UrbanPop ), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-18-1.pdf}

\hypertarget{using-the-lahman-data}{%
\subsection{Using the Lahman Data}\label{using-the-lahman-data}}

Let's take a look at some of the data available in the Lahman package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{( }\DataTypeTok{package =} \StringTok{"Lahman"}\NormalTok{ )}

\CommentTok{# Data sets in package ‘Lahman’:}
\CommentTok{#}
\CommentTok{# AllstarFull                            AllstarFull table}
\CommentTok{# Appearances                            Appearances table}
\CommentTok{# AwardsManagers                         AwardsManagers table}
\CommentTok{# AwardsPlayers                          AwardsPlayers table}
\CommentTok{# AwardsShareManagers                    AwardsShareManagers table}
\CommentTok{# AwardsSharePlayers                     AwardsSharePlayers table}
\CommentTok{# Batting                                Batting table}
\CommentTok{# BattingPost                            BattingPost table}
\CommentTok{# CollegePlaying                         CollegePlaying table}
\CommentTok{# Fielding                               Fielding table}
\CommentTok{# FieldingOF                             FieldingOF table}
\CommentTok{# FieldingPost                           FieldingPost data}
\CommentTok{# HallOfFame                             Hall of Fame Voting Data}
\CommentTok{# LahmanData                             Lahman Datasets}
\CommentTok{# Managers                               Managers table}
\CommentTok{# ManagersHalf                           ManagersHalf table}
\CommentTok{# Master                                 Master table}
\CommentTok{# Pitching                               Pitching table}
\CommentTok{# PitchingPost                           PitchingPost table}
\CommentTok{# Salaries                               Salaries table}
\CommentTok{# Schools                                Schools table}
\CommentTok{# SeriesPost                             SeriesPost table}
\CommentTok{# Teams                                  Teams table}
\CommentTok{# TeamsFranchises                        TeamFranchises table}
\CommentTok{# TeamsHalf                              TeamsHalf table}
\CommentTok{# battingLabels                          Variable Labels}
\CommentTok{# fieldingLabels                         Variable Labels}
\CommentTok{# pitchingLabels                         Variable Labels}
\end{Highlighting}
\end{Shaded}

We see that we have lots of datasets to choose from here. I will use the
Master dataset, which is a list of all of the Major League Baseball
players over the past century, and their personal information.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( Lahman )}

\KeywordTok{data}\NormalTok{( Master )}

\KeywordTok{names}\NormalTok{( Master )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "playerID"     "birthYear"    "birthMonth"   "birthDay"    
##  [5] "birthCountry" "birthState"   "birthCity"    "deathYear"   
##  [9] "deathMonth"   "deathDay"     "deathCountry" "deathState"  
## [13] "deathCity"    "nameFirst"    "nameLast"     "nameGiven"   
## [17] "weight"       "height"       "bats"         "throws"      
## [21] "debut"        "finalGame"    "retroID"      "bbrefID"     
## [25] "deathDate"    "birthDate"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{( Master )  }\CommentTok{# 18,354 players included}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 19105
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{( Master )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    playerID           birthYear      birthMonth        birthDay    
##  Length:19105       Min.   :1820   Min.   : 1.000   Min.   : 1.00  
##  Class :character   1st Qu.:1895   1st Qu.: 4.000   1st Qu.: 8.00  
##  Mode  :character   Median :1937   Median : 7.000   Median :16.00  
##                     Mean   :1931   Mean   : 6.629   Mean   :15.61  
##                     3rd Qu.:1969   3rd Qu.:10.000   3rd Qu.:23.00  
##                     Max.   :1996   Max.   :12.000   Max.   :31.00  
##                     NA's   :132    NA's   :302      NA's   :449    
##  birthCountry        birthState         birthCity           deathYear   
##  Length:19105       Length:19105       Length:19105       Min.   :1872  
##  Class :character   Class :character   Class :character   1st Qu.:1942  
##  Mode  :character   Mode  :character   Mode  :character   Median :1967  
##                                                           Mean   :1964  
##                                                           3rd Qu.:1990  
##                                                           Max.   :2017  
##                                                           NA's   :9664  
##    deathMonth        deathDay     deathCountry        deathState       
##  Min.   : 1.000   Min.   : 1.00   Length:19105       Length:19105      
##  1st Qu.: 3.000   1st Qu.: 8.00   Class :character   Class :character  
##  Median : 6.000   Median :15.00   Mode  :character   Mode  :character  
##  Mean   : 6.484   Mean   :15.57                                        
##  3rd Qu.:10.000   3rd Qu.:23.00                                        
##  Max.   :12.000   Max.   :31.00                                        
##  NA's   :9665     NA's   :9666                                         
##   deathCity          nameFirst           nameLast        
##  Length:19105       Length:19105       Length:19105      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
##                                                          
##                                                          
##   nameGiven             weight          height        bats      
##  Length:19105       Min.   : 65.0   Min.   :43.00   B   : 1175  
##  Class :character   1st Qu.:170.0   1st Qu.:71.00   L   : 4957  
##  Mode  :character   Median :185.0   Median :72.00   R   :11788  
##                     Mean   :186.4   Mean   :72.27   NA's: 1185  
##                     3rd Qu.:200.0   3rd Qu.:74.00               
##                     Max.   :320.0   Max.   :83.00               
##                     NA's   :854     NA's   :785                 
##   throws         debut            finalGame           retroID         
##  L   : 3653   Length:19105       Length:19105       Length:19105      
##  R   :14472   Class :character   Class :character   Class :character  
##  S   :    1   Mode  :character   Mode  :character   Mode  :character  
##  NA's:  979                                                           
##                                                                       
##                                                                       
##                                                                       
##    bbrefID            deathDate            birthDate         
##  Length:19105       Min.   :1872-03-17   Min.   :1820-04-17  
##  Class :character   1st Qu.:1942-06-05   1st Qu.:1896-11-21  
##  Mode  :character   Median :1967-03-06   Median :1939-01-01  
##                     Mean   :1964-10-11   Mean   :1933-03-08  
##                     3rd Qu.:1990-09-22   3rd Qu.:1970-04-02  
##                     Max.   :2017-02-19   Max.   :1996-08-12  
##                     NA's   :9666         NA's   :449
\end{verbatim}

We can use \textbf{help(Master)} to get information about the dataset,
including a data dictionary.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{help}\NormalTok{( Master )}
\end{Highlighting}
\end{Shaded}

\hypertarget{master-table}{%
\section{\texorpdfstring{\textbf{MASTER
TABLE}}{MASTER TABLE}}\label{master-table}}

\textbf{Description}

Master table - Player names, DOB, and biographical info. This file is to
be used to get details about players listed in the Batting, Pitching,
and other files where players are identified only by playerID.

\textbf{Usage}

data(Master)

\textbf{Format}

A data frame with 19105 observations on the following 26 variables.

\begin{itemize}
\tightlist
\item
  \textbf{playerID}: A unique code asssigned to each player. The
  playerID links the data in this file with records on players in the
  other files.
\item
  \textbf{birthYear}: Year player was born
\item
  \textbf{birthMonth}: Month player was born
\item
  \textbf{birthDay}: Day player was born
\item
  \textbf{birthCountry}: Country where player was born
\item
  \textbf{birthState}: State where player was born
\item
  \textbf{birthCity}: City where player was born
\item
  \textbf{deathYear}: Year player died
\item
  \textbf{deathMonth}: Month player died
\item
  \textbf{deathDay}: Day player died
\item
  \textbf{deathCountry}: Country where player died
\item
  \textbf{deathState}: State where player died
\item
  \textbf{deathCity}: City where player died
\item
  \textbf{nameFirst}: Player's first name
\item
  \textbf{nameLast}: Player's last name
\item
  \textbf{nameGiven}: Player's given name (typically first and middle)
\item
  \textbf{weight}: Player's weight in pounds
\item
  \textbf{height}: Player's height in inches
\item
  \textbf{bats}: a factor: Player's batting hand (left (L), right (R),
  or both (B))
\item
  \textbf{throws}: a factor: Player's throwing hand (left(L) or
  right(R))
\item
  \textbf{debut}: Date that player made first major league appearance
\item
  \textbf{finalGame}: Date that player made first major league
  appearance (blank if still active)
\item
  \textbf{retroID}: ID used by retrosheet,
  \url{http://www.retrosheet.org/}
\item
  \textbf{bbrefID}: ID used by Baseball Reference website,
  \url{http://www.baseball-reference.com/}
\item
  \textbf{birthDate}: Player's birthdate, in as.Date format
\item
  \textbf{deathDate}: Player's deathdate, in as.Date format
\end{itemize}

\textbf{Details}

debut, finalGame were converted from character strings with as.Date.

\textbf{Source}

Lahman, S. (2016) Lahman's Baseball Database, 1871-2015, 2015 version,
\url{http://www.seanlahman.com/baseball-archive/statistics/}

\hypertarget{example-analysis}{%
\subsection{Example Analysis}\label{example-analysis}}

Perhaps I am curious about some of the data. I see that we have
information on the birth month of professional baseball players. If you
have read Malcolm Gladwell's book \emph{Outliers} you know there is an
interesting cumulative advantage phenomenon that can occur with
atheletes as they are young. If you are born near the end of the cutoff,
you are on average six months older than other players in your league,
and therefore slightly larger physically and more coordinated on
average. Six months does not sound like much, but the slight size and
coordination advantage means more playing time, which also improves
skill. Over time, this small difference accumulates so that those lucky
enough to be born near the cutoff become the best players.

Gladwell looked at studies of hockey. Do we see this in baseball?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{( Master}\OperatorTok{$}\NormalTok{birthMonth )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##    1    2    3    4    5    6    7    8    9   10   11   12 
## 1631 1439 1528 1450 1449 1366 1503 1831 1661 1759 1620 1566
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab <-}\StringTok{ }\KeywordTok{prop.table}\NormalTok{( }\KeywordTok{table}\NormalTok{( Master}\OperatorTok{$}\NormalTok{birthMonth ) )}

\KeywordTok{names}\NormalTok{(tab) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Jan"}\NormalTok{,}\StringTok{"Feb"}\NormalTok{,}\StringTok{"Mar"}\NormalTok{,}\StringTok{"Apr"}\NormalTok{,}\StringTok{"May"}\NormalTok{,}\StringTok{"Jun"}\NormalTok{,}\StringTok{"Jul"}\NormalTok{,}\StringTok{"Aug"}\NormalTok{,}\StringTok{"Sep"}\NormalTok{,}\StringTok{"Oct"}\NormalTok{,}\StringTok{"Nov"}\NormalTok{,}\StringTok{"Dec"}\NormalTok{)}

\KeywordTok{dotchart}\NormalTok{( tab, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{"Percent of Players"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Birth Month"}\NormalTok{ ) }
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-22-1.pdf}

\hypertarget{data-structures}{%
\chapter{Data Structures}\label{data-structures}}

\hypertarget{vectors}{%
\section{Vectors}\label{vectors}}

Vectors are the building blocks of data programming in R, so they are
extremely important concepts.

Very loosely speaking a vector is a set of numbers or words. For
example, \emph{{[} 1, 2, 3{]}} or \emph{{[} apple, orange, pear {]}}. In
social science, a vector is a variable in a dataset.

You will spend a lot of time creating data vectors, transforming
variables, generating subsets, cleaning data, and adding new
observations. These are all accomplished through operators (commands)
that act on vectors.

There are four primary vector types (``classes'') in R:

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.45\columnwidth}\raggedright
Class\strut
\end{minipage} & \begin{minipage}[b]{0.49\columnwidth}\raggedright
Description\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.45\columnwidth}\raggedright
numeric\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
Typical variable of only numbers\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.45\columnwidth}\raggedright
character\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
A vector of letters or words, always enclosed with quotes\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.45\columnwidth}\raggedright
factor\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
Categories which represent groups, like treatment and control\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.45\columnwidth}\raggedright
logical\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
A vector of TRUE and FALSE to designate which observations fit a
criteria\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Each vector or dataset has a ``class'' that tells R the data type.

These different vectors can be combined into three different types of
datasets (data frames, matrices, and lists), which will be discussed
below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{167}\NormalTok{,}\DecValTok{185}\NormalTok{,}\DecValTok{119}\NormalTok{,}\DecValTok{142}\NormalTok{)}

\NormalTok{x2 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"adam"}\NormalTok{,}\StringTok{"jamal"}\NormalTok{,}\StringTok{"linda"}\NormalTok{,}\StringTok{"sriti"}\NormalTok{)}

\NormalTok{x3 <-}\StringTok{ }\KeywordTok{factor}\NormalTok{( }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{) )}

\NormalTok{x4 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{,}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{ )}

\NormalTok{x5 <-}\StringTok{ }\NormalTok{x4 }\OperatorTok{==}\StringTok{ "treatment"}

\NormalTok{dat <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{name=}\NormalTok{x2, }\DataTypeTok{sex=}\NormalTok{x3, }\DataTypeTok{treat=}\NormalTok{x4, }\DataTypeTok{is.treat=}\NormalTok{x5, }\DataTypeTok{strength=}\NormalTok{x1 )}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccccc@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\centering
name\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
sex\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\centering
treat\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
is.treat\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
strength\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\centering
adam\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
TRUE\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
167\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
jamal\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
FALSE\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
185\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
linda\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
TRUE\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
119\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
sriti\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
FALSE\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
142\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

R keeps track of the data type of each object:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( x1 )   }\CommentTok{# c(167,185,119,142)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( x2 )   }\CommentTok{# c("adam","jamal","linda","sriti")}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( x3 )   }\CommentTok{# factor( c("male","male","female","female") )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( x5 )   }\CommentTok{# c( "treatment","control","treatment","control" )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "logical"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( dat )  }\CommentTok{# data.frame( name=x2, sex=x3, treat=x4, is.treat=x5, strength=x1 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "data.frame"
\end{verbatim}

We often need to know how many elements belong to a vector, which we
find with the \textbf{length()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 167 185 119 142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{length}\NormalTok{( x1 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\hypertarget{casting}{%
\section{Casting}\label{casting}}

You can easily move from one data type to another by \emph{casting} a
specific type as another type:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}

\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.character}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "1" "2" "3" "4" "5"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{)}

\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE FALSE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.numeric}\NormalTok{( y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 0 1 1 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.character}\NormalTok{( y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "TRUE"  "FALSE" "TRUE"  "TRUE"  "FALSE"
\end{verbatim}

But in some cases it might not make sense to cast one variable type as
another.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}

\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.numeric}\NormalTok{( z )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA NA NA
\end{verbatim}

Casting will often be induced when you try to combine different types of
data. For example, when you add a character element to a numeric vector,
the whole vector will be cast as a character vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x10 <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}

\NormalTok{x10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# a vector can only have one data type}

\NormalTok{x11 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( x10, }\StringTok{"a"}\NormalTok{)}

\NormalTok{x11 }\CommentTok{# all numbers silently recast as characters}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "1" "2" "3" "4" "5" "a"
\end{verbatim}

When you read data in from outside sources, the input functions often
will cast numeric vectors as factors if they contain a low number of
elements. See the section on factors below for special instrucdtions on
moving from factors to numeric vectors.

\hypertarget{the-combine-function}{%
\section{The Combine Function}\label{the-combine-function}}

We often need to combine several elements into a single vector, or two
vectors to form one. This is done using the \textbf{c()} function.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"c"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}

\NormalTok{y <-}\StringTok{ }\DecValTok{10}\OperatorTok{:}\DecValTok{15}

\NormalTok{z <-}\StringTok{ }\KeywordTok{c}\NormalTok{(x,y)}

\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5 10 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(z,}\StringTok{"a"}\NormalTok{)  }\CommentTok{# combining data types }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "1"  "2"  "3"  "4"  "5"  "10" "11" "12" "13" "14" "15" "a"
\end{verbatim}

\hypertarget{numeric-vectors}{%
\section{Numeric Vectors}\label{numeric-vectors}}

There are some specific things to note about each vector type.

Math operators will only work on numeric vectors.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{( x1 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   119.0   136.2   154.5   153.2   171.5   185.0
\end{verbatim}

Note that if we try to run this mathematicl function we get an error:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{( x2 ) }\CommentTok{# Error in sum(x2) : invalid 'type' (character) of argument}
\end{Highlighting}
\end{Shaded}

Many functions in R are sensitive to the data type of vectors.
Mathematical functions, for example, do not make sense when applied to
text (character vectors). In many cases R will give an error. In some
cases R will silently re-cast the variable, then perform the operation.
Be watchful for when silent re-casting occurs because it might have
unwanted side effects, such as deleting data or re-coding group levels
in the wrong way.

\hypertarget{integers-are-simple-numeric-vectors}{%
\subsection{Integers Are Simple Numeric
Vectors}\label{integers-are-simple-numeric-vectors}}

The integer vector is a special type of numeric vector. It is used to
save memory since integers require less space than numbers that contain
decimals points (you need to allocate space for the numbers to the left
and the numbers to the right of the decimal). Google ``computer memory
allocation'' if you are interested in the specifics.

If you are doing advanced programming you will be more sensitive to
memory allocation and the speed of your code, but in the intro class we
will not differentiate between the two types of number vectors. In
\emph{most} cases they result in the same results, unless you are doing
advanced numerical analysis where rounding errors matter.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}

\NormalTok{n}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( n )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n[ }\DecValTok{2}\NormalTok{ ] <-}\StringTok{ }\FloatTok{2.01}

\NormalTok{n  }\CommentTok{# all elements converted to decimals}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.00 2.01 3.00 4.00 5.00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{( n )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "numeric"
\end{verbatim}

\hypertarget{character-vectors}{%
\section{Character Vectors}\label{character-vectors}}

The most important rule to remember with this data type: when creating
character vectors, all text must be enclosed by quotation marks.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{( }\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{ )   }\CommentTok{# this works}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# c( a, b, c )       # this doesn't work}
\CommentTok{# Error: object 'a' not found}
\end{Highlighting}
\end{Shaded}

When you type characters surrounded by quotes then R knows you are
creating new text (``strings'' in programming speak). When you type
characters that are not surrounded by quotes, R thinks that you are
looking for an object in the environment, like the variables we have
already created. It gets confused when it doesn't find the object that
you typed.

In generate, you will use quotes when you are creating character
vectors, and for arguments in functions. You do not use quotes when you
are referencing an active object.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ls}\NormalTok{()   }\CommentTok{# these are all of the active objects}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "dat"       "Master"    "n"         "tab"       "USArrests"
##  [6] "x"         "x1"        "x10"       "x11"       "x2"       
## [11] "x3"        "x4"        "x5"        "y"         "z"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"x1"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "x1"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 167 185 119 142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{( }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{), }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\DecValTok{4}\NormalTok{ )   }\CommentTok{# text used for color argument, use quotes}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-36-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# what if we want colors that represent groups in our data}

\KeywordTok{plot}\NormalTok{( }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, x1, }\DataTypeTok{col=}\NormalTok{x3, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\DecValTok{4}\NormalTok{ )       }\CommentTok{# object used for color argument, no quotes}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-36-2.pdf}

Recall that x3 is the sex of study participants, so the different colors
represent the different genders in the study.

\hypertarget{logical-vectors}{%
\section{Logical Vectors}\label{logical-vectors}}

Logical vectors are collections of a set of TRUE and FALSE statements.

Logical statements allow us to define groups based upon criteria, then
decide whether observations belong to the group. See the section on
\textbf{operators} below for a complete list of logical statements.

Logical vectors are important because organizing data into these sets is
what drives all of the advanced data analytics (set theory is at the
basis of mathematics and computer science).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat is.treat strength
## 1  adam   male treatment     TRUE      167
## 2 jamal   male   control    FALSE      185
## 3 linda female treatment     TRUE      119
## 4 sriti female   control    FALSE      142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\OperatorTok{$}\NormalTok{name }\OperatorTok{==}\StringTok{ "sriti"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "male"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\OperatorTok{$}\NormalTok{strength }\OperatorTok{>}\StringTok{ }\DecValTok{180}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE FALSE FALSE
\end{verbatim}

Typically logical vectors are used in combination with subset operators
to identify specific groups in the data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat is.treat strength
## 1  adam   male treatment     TRUE      167
## 2 jamal   male   control    FALSE      185
## 3 linda female treatment     TRUE      119
## 4 sriti female   control    FALSE      142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# isolate data on all of the females in the dataset}

\NormalTok{dat[ dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ , ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat is.treat strength
## 3 linda female treatment     TRUE      119
## 4 sriti female   control    FALSE      142
\end{verbatim}

When defining logical vectors, you can use the abbreviated versions of T
for TRUE and F for FALSE.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(T,T,F,T,F,F)}

\NormalTok{z1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE  TRUE FALSE FALSE
\end{verbatim}

Note how NAs affect complex logical statements:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{TRUE} \OperatorTok{&}\StringTok{ }\OtherTok{TRUE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{TRUE} \OperatorTok{&}\StringTok{ }\OtherTok{FALSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{TRUE} \OperatorTok{&}\StringTok{ }\OtherTok{NA}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{FALSE} \OperatorTok{&}\StringTok{ }\OtherTok{NA}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

If one condition is TRUE, and another is NA, R does not want to throw
out the data because the state of the missing value is unclear. As a
result, it will preserve the observation, but it will replace all of the
data with missing values:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat is.treat strength
## 1  adam   male treatment     TRUE      167
## 2 jamal   male   control    FALSE      185
## 3 linda female treatment     TRUE      119
## 4 sriti female   control    FALSE      142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{keep.these <-}\StringTok{ }\KeywordTok{c}\NormalTok{(T,F,}\OtherTok{NA}\NormalTok{,F)}

\NormalTok{dat[ keep.these , ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name  sex     treat is.treat strength
## 1  adam male treatment     TRUE      167
## NA <NA> <NA>      <NA>       NA       NA
\end{verbatim}

To remove these rows, replace all NAs in your selector vector with
FALSE:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{keep.these[ }\KeywordTok{is.na}\NormalTok{(keep.these) ] <-}\StringTok{ }\OtherTok{FALSE}

\NormalTok{dat[ keep.these , ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   name  sex     treat is.treat strength
## 1 adam male treatment     TRUE      167
\end{verbatim}

\hypertarget{factors}{%
\section{Factors}\label{factors}}

When there are categorical variables within our data, or groups, then we
use a special vector to keep track of these groups. We could just use
numbers (1=female, 0=male) or characters (``male'',``female''), but
factors are useful for two reasons.

First, it saves memory. Text is very ``expensive'' in terms of memory
allocation and processing speed, so using simpler data structure makes R
faster.

Second, when a variable is set as a factor, R recognizes that it
represents a group and it can deploy object-oriented functionality. When
you use a factor in analysis, R knows that you want to split the
analysis up by groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{height <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\DecValTok{70}\NormalTok{, }\DecValTok{68}\NormalTok{, }\DecValTok{62}\NormalTok{, }\DecValTok{64}\NormalTok{, }\DecValTok{72}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{58}\NormalTok{, }\DecValTok{63}\NormalTok{  )}

\NormalTok{strength <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{167}\NormalTok{,}\DecValTok{185}\NormalTok{,}\DecValTok{119}\NormalTok{,}\DecValTok{142}\NormalTok{,}\DecValTok{175}\NormalTok{,}\DecValTok{204}\NormalTok{,}\DecValTok{124}\NormalTok{,}\DecValTok{117}\NormalTok{)}

\NormalTok{sex <-}\StringTok{ }\KeywordTok{factor}\NormalTok{( }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{ ) )}

\KeywordTok{plot}\NormalTok{( height, strength )   }\CommentTok{# simple scatter plot}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-43-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{( sex, strength )      }\CommentTok{# box and whisker plot       }
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-43-2.pdf}

Factors are more memory efficient than character vectors because they
store the underlying data as a numeric vector instead of a categorical
(text) vector. Each group in the data is assigned a number, and when
printing items the program only has to remember which group corresponds
to which number:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] male   male   female female male   male   female female
## Levels: female male
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.numeric}\NormalTok{( sex )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 2 1 1 2 2 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#  male = 2}
\CommentTok{#  female = 1}
\end{Highlighting}
\end{Shaded}

If you print a factor, the computer just replaces each category
designation with its name (2 would be replaced with ``male'' in this
example). These replacements can be done in real time without clogging
the memory of your computer as they don't need to be saved.

In some instances a categorical variable might be represented by
numbers. For example, grades 9-12 for high school kids. The \textbf{very
important} rule to remember with factors is you can't move directly from
the factor to numeric using the \textbf{as.numeric()} casting function.
This will give you the underlying data structure, but will not give you
the category names. To get these, you need the \textbf{as.character}
casting function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grades <-}\StringTok{ }\KeywordTok{sample}\NormalTok{( }\DataTypeTok{x=}\DecValTok{9}\OperatorTok{:}\DecValTok{12}\NormalTok{, }\DataTypeTok{size=}\DecValTok{10}\NormalTok{, }\DataTypeTok{replace=}\NormalTok{T )}

\NormalTok{grades}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 11 10 12 12 10 12 11 10  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grades <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{( grades )}

\NormalTok{grades}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 11 10 12 12 10 12 11 10 9  10
## Levels: 9 10 11 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.numeric}\NormalTok{( grades )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 3 2 4 4 2 4 3 2 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.character}\NormalTok{( grades )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "11" "10" "12" "12" "10" "12" "11" "10" "9"  "10"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# to get back to the original numeric vector}

\KeywordTok{as.numeric}\NormalTok{( }\KeywordTok{as.character}\NormalTok{( grades ))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 11 10 12 12 10 12 11 10  9 10
\end{verbatim}

Note that when subsetting a factor, it will retain all of the original
levels, even when they are not in use.

In this example, there are 37 teams in the Lahman dataset (some of them
defunct) and 16 teams in the National League in 2002. But after applying
the year and league subsets you will still have 37 levels.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# there are only 16 teams in the NL in 2002}

\NormalTok{sals}\FloatTok{.2002}\NormalTok{ <-}\StringTok{ }\NormalTok{Salaries [Salaries}\OperatorTok{$}\NormalTok{yearID}\OperatorTok{==}\StringTok{"2002"}\NormalTok{, ]}
\NormalTok{nl.sals <-}\StringTok{ }\NormalTok{sals}\FloatTok{.2002}\NormalTok{ [ sals}\FloatTok{.2002}\OperatorTok{$}\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{,]}
\KeywordTok{levels}\NormalTok{( nl.sals}\OperatorTok{$}\NormalTok{teamID )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "ANA" "ARI" "ATL" "BAL" "BOS" "CAL" "CHA" "CHC" "CHN" "CHW" "CIN"
## [12] "CLE" "COL" "DET" "FLO" "HOU" "KCA" "KCR" "LAA" "LAD" "LAN" "MIA"
## [23] "MIL" "MIN" "ML4" "MON" "NYA" "NYM" "NYN" "NYY" "OAK" "PHI" "PIT"
## [34] "SDN" "SDP" "SEA" "SFG" "SFN" "SLN" "STL" "TBA" "TBR" "TEX" "TOR"
## [45] "WAS" "WSN"
\end{verbatim}

After applying a subset, in order to remove the unused factor levels you
need to apply either droplevels(), or else recast your factor as a new
factor.

For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sals}\FloatTok{.2002}\NormalTok{ <-}\StringTok{ }\NormalTok{Salaries [Salaries}\OperatorTok{$}\NormalTok{yearID}\OperatorTok{==}\StringTok{"2002"}\NormalTok{, ]}

\NormalTok{nl.sals <-}\StringTok{ }\NormalTok{sals}\FloatTok{.2002}\NormalTok{ [ sals}\FloatTok{.2002}\OperatorTok{$}\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{,]}
\KeywordTok{levels}\NormalTok{( nl.sals}\OperatorTok{$}\NormalTok{teamID )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "ANA" "ARI" "ATL" "BAL" "BOS" "CAL" "CHA" "CHC" "CHN" "CHW" "CIN"
## [12] "CLE" "COL" "DET" "FLO" "HOU" "KCA" "KCR" "LAA" "LAD" "LAN" "MIA"
## [23] "MIL" "MIN" "ML4" "MON" "NYA" "NYM" "NYN" "NYY" "OAK" "PHI" "PIT"
## [34] "SDN" "SDP" "SEA" "SFG" "SFN" "SLN" "STL" "TBA" "TBR" "TEX" "TOR"
## [45] "WAS" "WSN"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fix in one of two equivalent ways:}
\CommentTok{#}
\CommentTok{# nl.sals$teamID <- droplevels( nl.sals$teamID )}
\CommentTok{# nl.sals$teamID <- factor( nl.sals$teamID )}

\KeywordTok{levels}\NormalTok{( nl.sals}\OperatorTok{$}\NormalTok{teamID )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "ANA" "ARI" "ATL" "BAL" "BOS" "CAL" "CHA" "CHC" "CHN" "CHW" "CIN"
## [12] "CLE" "COL" "DET" "FLO" "HOU" "KCA" "KCR" "LAA" "LAD" "LAN" "MIA"
## [23] "MIL" "MIN" "ML4" "MON" "NYA" "NYM" "NYN" "NYY" "OAK" "PHI" "PIT"
## [34] "SDN" "SDP" "SEA" "SFG" "SFN" "SLN" "STL" "TBA" "TBR" "TEX" "TOR"
## [45] "WAS" "WSN"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nl.sals}\OperatorTok{$}\NormalTok{teamID <-}\StringTok{ }\KeywordTok{droplevels}\NormalTok{( nl.sals}\OperatorTok{$}\NormalTok{teamID )}
\KeywordTok{levels}\NormalTok{( nl.sals}\OperatorTok{$}\NormalTok{teamID )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "ARI" "ATL" "CHN" "CIN" "COL" "FLO" "HOU" "LAN" "MIL" "MON" "NYN"
## [12] "PHI" "PIT" "SDN" "SFN" "SLN"
\end{verbatim}

\hypertarget{generating-vectors}{%
\section{Generating Vectors}\label{generating-vectors}}

You will often need to generate vectors for data transformations or
simulations. Here are the most common functions that will be helpful.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# repeat a number, or series of numbers}

\KeywordTok{rep}\NormalTok{( }\DataTypeTok{x=}\DecValTok{9}\NormalTok{, }\DataTypeTok{times=}\DecValTok{5}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9 9 9 9 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rep}\NormalTok{( }\DataTypeTok{x=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{), }\DataTypeTok{times=}\DecValTok{5}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 5 7 5 7 5 7 5 7 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rep}\NormalTok{( }\DataTypeTok{x=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{), }\DataTypeTok{each=}\DecValTok{5}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 5 5 5 5 5 7 7 7 7 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rep}\NormalTok{( }\DataTypeTok{x=}\KeywordTok{c}\NormalTok{(}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{), }\DataTypeTok{each=}\DecValTok{5}\NormalTok{ )  }\CommentTok{# also works to create categories}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "treatment" "treatment" "treatment" "treatment" "treatment"
##  [6] "control"   "control"   "control"   "control"   "control"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a sequence of numbers}

\KeywordTok{seq}\NormalTok{( }\DataTypeTok{from=}\DecValTok{1}\NormalTok{, }\DataTypeTok{to=}\DecValTok{15}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{seq}\NormalTok{( }\DataTypeTok{from=}\DecValTok{1}\NormalTok{, }\DataTypeTok{to=}\DecValTok{15}\NormalTok{, }\DataTypeTok{by=}\DecValTok{3}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1  4  7 10 13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\OperatorTok{:}\DecValTok{15}   \CommentTok{# shorthand if by=1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a random sample}

\NormalTok{hat <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"c"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"f"}\NormalTok{)}

\KeywordTok{sample}\NormalTok{( }\DataTypeTok{x=}\NormalTok{hat, }\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "b" "c" "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sample}\NormalTok{( }\DataTypeTok{x=}\NormalTok{hat, }\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "f" "b" "c"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sample}\NormalTok{( }\DataTypeTok{x=}\NormalTok{hat, }\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "c" "f" "a"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# for multiple samples use replacement}

\KeywordTok{sample}\NormalTok{( }\DataTypeTok{x=}\NormalTok{hat, }\DataTypeTok{size=}\DecValTok{10}\NormalTok{, }\DataTypeTok{replace=}\OtherTok{TRUE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "c" "a" "c" "b" "c" "b" "f" "a" "c" "b"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create data that follows a normal curve}

\NormalTok{iq <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{( }\DataTypeTok{n=}\DecValTok{1000}\NormalTok{, }\DataTypeTok{mean=}\DecValTok{100}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{15}\NormalTok{ )}

\KeywordTok{hist}\NormalTok{( iq, }\DataTypeTok{col=}\StringTok{"gray"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-48-1.pdf}

\hypertarget{operators}{%
\chapter{Operators}\label{operators}}

Logical operators are the most basic type of data programming and the
core of many types of data analysis. Most of the time we are not
conducting fancy statistics, we just want to identify members of a group
(print all of the females from the study), or describe things that
belong to a subset of the data (compare the average price of houses with
garages to houses without garages).

In order to accomplish these simple tasks we need to use logic
statements. A logic statement answers the question, does an observation
belong to a group.

Many times groups are simple. Show me all of the professions that make
over \$100k a year, for example.

Sometimes groups are complex. Identify the African American children
from a specific zip code in Chicago that live in households with single
mothers.

You will use nine basic logical operators:

\begin{longtable}[]{@{}ll@{}}
\toprule
Operator & Description\tabularnewline
\midrule
\endhead
\textless{} & less than\tabularnewline
\textless{}= & less than or equal to\tabularnewline
\textgreater{} & greater than\tabularnewline
\textgreater{}= & greater than or equal to\tabularnewline
== & exactly equal to\tabularnewline
!= & not equal to\tabularnewline
x \textbar{} y & x OR y\tabularnewline
x \& y & x AND y\tabularnewline
! & opposite of\tabularnewline
\bottomrule
\end{longtable}

Logical operators create logical vectors, a vector that contains only
TRUE or FALSE. The TRUE means that the observation belongs to the group,
FALSE means it does not.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)}

\NormalTok{x2 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{)}

\NormalTok{x3 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{,}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{)}

\NormalTok{x1 }\OperatorTok{>}\StringTok{ }\DecValTok{7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 }\OperatorTok{>=}\StringTok{ }\DecValTok{7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 }\OperatorTok{==}\StringTok{ }\DecValTok{9}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 =}\StringTok{ }\DecValTok{9}  \CommentTok{# don't use a single equals operator!  it overwrites your variable}

\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)}

\NormalTok{x1 }\OperatorTok{==}\StringTok{ }\DecValTok{9} \OperatorTok{|}\StringTok{ }\NormalTok{x1 }\OperatorTok{==}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# x2 == male  # this will not work because male is not enclosed with quotes}

\NormalTok{x2 }\OperatorTok{==}\StringTok{ "female"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x2 }\OperatorTok{==}\StringTok{ "female"} \OperatorTok{&}\StringTok{ }\NormalTok{x3 }\OperatorTok{==}\StringTok{ "treatment"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE FALSE
\end{verbatim}

Note that we use operators to create logical vectors where TRUE
designates observation that belong to the defined group, and FALSE
designates observations outside the group. We use these logical vectors
in three ways:

\begin{enumerate}
\def\labelenumi{(\arabic{enumi})}
\tightlist
\item
  We can create a selector variable that is used for subsets. When a
  logical vector is passed to the subset function it will keep all
  observations with a TRUE value, and drop observations with a FALSE
  value.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7 9 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 }\OperatorTok{>}\StringTok{ }\DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{keep.these <-}\StringTok{ }\NormalTok{x1 }\OperatorTok{>}\StringTok{ }\DecValTok{5}

\NormalTok{x1[ keep.these ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# you can create a selector variable with one variable, and apply it to another}

\NormalTok{x2[ keep.these ]  }\CommentTok{# sex of observations where x1 > 5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "male" "male"
\end{verbatim}

\begin{enumerate}
\def\labelenumi{(\arabic{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  Logical vectors give us an easy way to count things within defined
  groups.
\end{enumerate}

We can apply a \textbf{sum()} function to a logical vector, and the
result will be a tally of all of the TRUE cases.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# how many females do we have in our study?}

\KeywordTok{sum}\NormalTok{( x2 }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# how many females do we have in our treatment group?}

\KeywordTok{sum}\NormalTok{( x2 }\OperatorTok{==}\StringTok{ "female"} \OperatorTok{&}\StringTok{ }\NormalTok{x3 }\OperatorTok{==}\StringTok{ "treatment"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{enumerate}
\def\labelenumi{(\arabic{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
  We use selector variables to replace observations with new values
  using the assignment operator. This is similar to a find and replace
  operation.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x7 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\StringTok{"mole"}\NormalTok{,}\StringTok{"mouse"}\NormalTok{,}\StringTok{"shrew"}\NormalTok{,}\StringTok{"mouse"}\NormalTok{,}\StringTok{"rat"}\NormalTok{,}\StringTok{"shrew"}\NormalTok{)}

\CommentTok{# the lab assistant incorrectly identified the shrews}

\NormalTok{x7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "mole"  "mouse" "shrew" "mouse" "rat"   "shrew"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x7[ x7 }\OperatorTok{==}\StringTok{ "shrew"}\NormalTok{ ] <-}\StringTok{ "possum"}

\NormalTok{x7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "mole"   "mouse"  "possum" "mouse"  "rat"    "possum"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# we don't know if linda received the treatment}

\NormalTok{x3 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"adam"}\NormalTok{,}\StringTok{"jamal"}\NormalTok{,}\StringTok{"linda"}\NormalTok{,}\StringTok{"sriti"}\NormalTok{)}

\NormalTok{x4 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{,}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{)}

\NormalTok{x4[ x3 }\OperatorTok{==}\StringTok{ "linda"}\NormalTok{ ] <-}\StringTok{ }\OtherTok{NA}

\NormalTok{x4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "treatment" "control"   NA          "control"
\end{verbatim}

The \textbf{!} operator is a special case, where it is not used to
define a new logical vector, but rather it swaps the values of an
existing logical vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7 9 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{these <-}\StringTok{ }\NormalTok{x1 }\OperatorTok{>}\StringTok{ }\DecValTok{5}

\NormalTok{these}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{!}\StringTok{ }\NormalTok{these}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{!}\StringTok{ }\OtherTok{TRUE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{!}\StringTok{ }\OtherTok{FALSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\hypertarget{datasets}{%
\section{Datasets}\label{datasets}}

When we combine multiple vectors together, we now have a dataset. There
are three main types that we will use in this class.

\begin{longtable}[]{@{}ll@{}}
\toprule
Class & Description\tabularnewline
\midrule
\endhead
data frame & A typical data set comprised of several
variables\tabularnewline
matrix & A data set comprised of only numbers, used for matrix
math\tabularnewline
list & The grab bag of data structures - several vectors held
together\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{data-frames}{%
\subsection{Data Frames}\label{data-frames}}

The most familiar spreadsheet-type data structure is called a data frame
in R. It consists of rows, which represent observations, and columns,
which represent variables.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{( USArrests )}

\KeywordTok{dim}\NormalTok{( USArrests )   }\CommentTok{# number of rows by number of columns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 50  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{( USArrests )   }\CommentTok{# variable names or column names}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Murder"   "Assault"  "UrbanPop" "Rape"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{row.names}\NormalTok{( USArrests )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Alabama"        "Alaska"         "Arizona"        "Arkansas"      
##  [5] "California"     "Colorado"       "Connecticut"    "Delaware"      
##  [9] "Florida"        "Georgia"        "Hawaii"         "Idaho"         
## [13] "Illinois"       "Indiana"        "Iowa"           "Kansas"        
## [17] "Kentucky"       "Louisiana"      "Maine"          "Maryland"      
## [21] "Massachusetts"  "Michigan"       "Minnesota"      "Mississippi"   
## [25] "Missouri"       "Montana"        "Nebraska"       "Nevada"        
## [29] "New Hampshire"  "New Jersey"     "New Mexico"     "New York"      
## [33] "North Carolina" "North Dakota"   "Ohio"           "Oklahoma"      
## [37] "Oregon"         "Pennsylvania"   "Rhode Island"   "South Carolina"
## [41] "South Dakota"   "Tennessee"      "Texas"          "Utah"          
## [45] "Vermont"        "Virginia"       "Washington"     "West Virginia" 
## [49] "Wisconsin"      "Wyoming"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{( USArrests )  }\CommentTok{# print first six rows of the data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            Murder Assault UrbanPop Rape
## Alabama      13.2     236       58 21.2
## Alaska       10.0     263       48 44.5
## Arizona       8.1     294       80 31.0
## Arkansas      8.8     190       50 19.5
## California    9.0     276       91 40.6
## Colorado      7.9     204       78 38.7
\end{verbatim}

\hypertarget{matrices}{%
\subsection{Matrices}\label{matrices}}

A matrix is also a rectangular data object that consists of collections
of vectors, but it is special in the sense that it only has numeric
vectors and no variable names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{( }\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{ )}

\NormalTok{mat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{( mat )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{( mat )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{as.data.frame}\NormalTok{( mat )  }\CommentTok{# creates variable names}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   V1 V2 V3 V4
## 1  1  6 11 16
## 2  2  7 12 17
## 3  3  8 13 18
## 4  4  9 14 19
## 5  5 10 15 20
\end{verbatim}

These are used almost exclusively for matrix algebra operations, which
are fundamental to mathematical statistics. We will not use matrices in
this course.

\hypertarget{lists}{%
\subsection{Lists}\label{lists}}

The list is the most flexible data structure. It is created by sticking
a bunch of unrelated vectors or datasets together. For example, when you
run a regression you generate a bunch of interesting information. This
information is saved as a list.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{100}
\NormalTok{y <-}\StringTok{ }\DecValTok{2}\OperatorTok{*}\NormalTok{x }\OperatorTok{+}\StringTok{ }\KeywordTok{rnorm}\NormalTok{( }\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{)}

\NormalTok{m}\FloatTok{.01}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{( y }\OperatorTok{~}\StringTok{ }\NormalTok{x )}

\KeywordTok{names}\NormalTok{( m}\FloatTok{.01}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "coefficients"  "residuals"     "effects"       "rank"         
##  [5] "fitted.values" "assign"        "qr"            "df.residual"  
##  [9] "xlevels"       "call"          "terms"         "model"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m}\FloatTok{.01}\OperatorTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)           x 
##    1.627087    1.959923
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m}\FloatTok{.01}\OperatorTok{$}\NormalTok{residuals}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           1           2           3           4           5           6 
##  -3.3199430  -8.8471916  -8.9037293  17.1628757   0.1053002  -0.9350838 
##           7           8           9          10          11          12 
##  11.1436049   1.4728915  -9.3970245   4.1762872  -2.5235958   6.2648346 
##          13          14          15          16          17          18 
##   3.4432171  15.6539993   9.9097900  11.5377418   3.9476094  -0.2303832 
##          19          20          21          22          23          24 
## -14.9733964   9.6907805  -1.8914329  -4.1454659  -2.2424013  -1.6000921 
##          25          26          27          28          29          30 
##   7.8638525   0.4932791   8.1874311  -6.0725311  -5.5742479  -5.1425821 
##          31          32          33          34          35          36 
## -24.1317806  -1.8965247  15.1955624  -9.0420207 -13.6084419   8.5960570 
##          37          38          39          40          41          42 
##  -2.2512133 -12.3826641   0.5084214  -2.7066643 -17.3927800  -3.5486522 
##          43          44          45          46          47          48 
##  -1.5634771  -0.4867401  12.3252667  17.7448113   6.6109084   5.9680029 
##          49          50          51          52          53          54 
##  -0.9462096  -5.0285405 -24.3215531  -3.0000102  14.1442858  -0.8967095 
##          55          56          57          58          59          60 
## -16.5744058  -5.6736788   6.5037348  -3.2563453  14.1658651  -8.9919132 
##          61          62          63          64          65          66 
##  -0.2163929  17.1882234   2.5563967   3.9119201   0.1485461  -6.1592847 
##          67          68          69          70          71          72 
## -11.1282193 -14.0004776 -13.0135856  -7.1498597  12.9685121   0.6760866 
##          73          74          75          76          77          78 
##  11.6670615  16.1148703   0.1635857  -9.8775955   8.9103138  -5.1760965 
##          79          80          81          82          83          84 
##  12.3975334  -1.8542256 -15.6346448  -6.7971611  15.0419695   5.2611197 
##          85          86          87          88          89          90 
##   3.9936580  -3.3318203  -5.5035963  -9.0840286   4.5254526   6.0045809 
##          91          92          93          94          95          96 
##  13.7023047   6.3213092 -15.7292018   0.1631878 -13.4607593   1.3184298 
##          97          98          99         100 
##  -6.8528818  10.2380248   2.0822008  10.2975589
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m}\FloatTok{.01}\OperatorTok{$}\NormalTok{call}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## lm(formula = y ~ x)
\end{verbatim}

These output are all related to the model we have run, so they are kept
organized by the list so they can be used for various further steps like
comparing models or checking for model fit.

A data frame is a bit more rigid that a list in that you cannot combine
elements that do not have the same dimsions.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# new.dataframe <- data.frame( m.01$coefficients, m.01$residuals, m.01$call )}
\CommentTok{#}
\CommentTok{# these will fail because the vectors have different lengths }
\end{Highlighting}
\end{Shaded}

\hypertarget{subsets}{%
\section{Subsets}\label{subsets}}

The subset operators \textbf{{[} {]}} are one of the most common you
will use in R.

The primary rule of subsets is to use a data operator to create a
logical selector vector, and use that to generate subsets. Any
observation that corresponds to TRUE will be retained, any observation
that corresponds to FALSE will be dropped.

For vectors, you need to specify a single dimension.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{167}\NormalTok{,}\DecValTok{185}\NormalTok{,}\DecValTok{119}\NormalTok{,}\DecValTok{142}\NormalTok{)}

\NormalTok{x2 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"adam"}\NormalTok{,}\StringTok{"jamal"}\NormalTok{,}\StringTok{"linda"}\NormalTok{,}\StringTok{"sriti"}\NormalTok{)}

\NormalTok{x3 <-}\StringTok{ }\KeywordTok{factor}\NormalTok{( }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{) )}

\NormalTok{x4 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{,}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{ )}

\NormalTok{dat <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{name=}\NormalTok{x2, }\DataTypeTok{sex=}\NormalTok{x3, }\DataTypeTok{treat=}\NormalTok{x4, }\DataTypeTok{strength=}\NormalTok{x1 )}


\NormalTok{these <-}\StringTok{ }\NormalTok{x1 }\OperatorTok{>}\StringTok{ }\DecValTok{140}     \CommentTok{# selector vector}

\NormalTok{these}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1[ these ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 167 185 142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x2[ these ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "adam"  "jamal" "sriti"
\end{verbatim}

For data frames, you need two dimensions (rows and columns). The two
dimensions are seperated by a comma, and if you leave one blank you will
not drop anything.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# dat[  row position ,  column position  ]}

\NormalTok{dat }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat strength
## 1  adam   male treatment      167
## 2 jamal   male   control      185
## 3 linda female treatment      119
## 4 sriti female   control      142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{these <-}\StringTok{ }\NormalTok{dat}\OperatorTok{$}\NormalTok{treat }\OperatorTok{==}\StringTok{ "treatment"}

\NormalTok{dat[ these , ]   }\CommentTok{# all data in the treatment group}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat strength
## 1  adam   male treatment      167
## 3 linda female treatment      119
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat[ , }\KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{,}\StringTok{"sex"}\NormalTok{) ]  }\CommentTok{# select two columns of data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex
## 1  adam   male
## 2 jamal   male
## 3 linda female
## 4 sriti female
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# to keep a subset as a separate dataset}

\NormalTok{dat.women <-}\StringTok{ }\NormalTok{dat[ dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ , ]}

\NormalTok{dat.women}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat strength
## 3 linda female treatment      119
## 4 sriti female   control      142
\end{verbatim}

Note the rules listed above about subsetting factors. After applying a
subset, they will retain all of the original levels, even when they are
not longer useful. You need to drop the unused levels if you would like
them to be omitted from functions that use the factor levels for
analysis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{letters=}\NormalTok{LETTERS[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{], }\DataTypeTok{numbers=}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{) )}

\KeywordTok{levels}\NormalTok{( df}\OperatorTok{$}\NormalTok{letters )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "A" "B" "C" "D" "E"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sub.df <-}\StringTok{ }\NormalTok{df[ }\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{, ]}

\NormalTok{sub.df}\OperatorTok{$}\NormalTok{letters}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] A B C
## Levels: A B C D E
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{levels}\NormalTok{( sub.df}\OperatorTok{$}\NormalTok{letters )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "A" "B" "C" "D" "E"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{droplevels}\NormalTok{( sub.df}\OperatorTok{$}\NormalTok{letters )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] A B C
## Levels: A B C
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sub.df}\OperatorTok{$}\NormalTok{letters <-}\StringTok{ }\KeywordTok{droplevels}\NormalTok{( sub.df}\OperatorTok{$}\NormalTok{letters )}
\end{Highlighting}
\end{Shaded}

\hypertarget{variable-transformations}{%
\section{Variable Transformations}\label{variable-transformations}}

When we create a new variable from existing variables, it is called a
`transformation'. This is very common in data science. Crime is measures
by the number of assults \emph{per 100,000 people}, for example (crime /
pop). A batting average is the number of hits divided by the number of
at bats.

In R, mathematical operations are \emph{vectorized}, which means that
operations are performed on the entire vector all at once. This makes
transformations fast and easy.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}

\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  6  7  8  9 10 11 12 13 14 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OperatorTok{*}\StringTok{ }\DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  5 10 15 20 25 30 35 40 45 50
\end{verbatim}

R uses a convention called ``recycling'', which means that it will
re-use elements of a vector if necessary. In the example below the x
vector has 10 elements, but the y vector only has 5 elements. When we
run out of y, we just start over from the beginning. This is powerful in
some instances, but can be dangerous in others if you don't realize that
that it is happening.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}

\NormalTok{y <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}

\NormalTok{x }\OperatorTok{+}\StringTok{ }\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  2  4  6  8 10  7  9 11 13 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OperatorTok{*}\StringTok{ }\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  4  9 16 25  6 14 24 36 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# the colors are recycled}

\KeywordTok{plot}\NormalTok{( }\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\DecValTok{3}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-62-1.pdf}

Here is an example of recycling gone wrong:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{167}\NormalTok{,}\DecValTok{185}\NormalTok{,}\DecValTok{119}\NormalTok{,}\DecValTok{142}\NormalTok{)}

\NormalTok{x2 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"adam"}\NormalTok{,}\StringTok{"jamal"}\NormalTok{,}\StringTok{"linda"}\NormalTok{,}\StringTok{"sriti"}\NormalTok{)}

\NormalTok{x3 <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"female"}\NormalTok{)}

\NormalTok{x4 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\StringTok{"treatment"}\NormalTok{,}\StringTok{"contro"}\NormalTok{,}\StringTok{"treatment"}\NormalTok{,}\StringTok{"control"}\NormalTok{ )}

\NormalTok{dat <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{name=}\NormalTok{x2, }\DataTypeTok{sex=}\NormalTok{x3, }\DataTypeTok{treat=}\NormalTok{x4, }\DataTypeTok{strength=}\NormalTok{x1 )}


\CommentTok{# create a subset of data of all female study participants}

\NormalTok{dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "female"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{these <-}\StringTok{ }\NormalTok{dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "female"}

\NormalTok{dat[ these, ]  }\CommentTok{# correct subset}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat strength
## 3 linda female treatment      119
## 4 sriti female   control      142
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# same thing, but i mess is up - the female element is recycled in the overwrite}

\NormalTok{dat}\OperatorTok{$}\NormalTok{sex =}\StringTok{ "female"}    \CommentTok{# whoops just over-wrote my data! should be double equal}

\NormalTok{these <-}\StringTok{ }\NormalTok{dat}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "female"} 

\NormalTok{dat[ these , ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    name    sex     treat strength
## 1  adam female treatment      167
## 2 jamal female    contro      185
## 3 linda female treatment      119
## 4 sriti female   control      142
\end{verbatim}

\hypertarget{missing-values-nas}{%
\section{Missing Values: NA's}\label{missing-values-nas}}

Missing values are coded differently in each data analysis program. SPSS
uses a period, for example. In R, missing values are coded as ``NA''.

The important thing to note is that R wants to make sure you know there
are missing values if you are conducting analysis. As a result, it will
give you the answer of ``NA'' when you try to do math with a vector that
includes a missing value. You have to ask it explicitly to ignore the
missing value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{ )}

\NormalTok{x5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{( x5 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{( x5 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5 <-}\StringTok{ }\KeywordTok{c}\NormalTok{( }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{4}\NormalTok{ )}

\NormalTok{x5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1  2 NA  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# should missing values be treated as zeros or dropped? }

\KeywordTok{sum}\NormalTok{( x5 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{( x5 )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{( x5, }\DataTypeTok{na.rm=}\NormalTok{T )   }\CommentTok{# na.rm=T argument drops missing values}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{( x5, }\DataTypeTok{na.rm=}\NormalTok{T )  }\CommentTok{# na.rm=T argument drops missing values}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.333333
\end{verbatim}

You cannot use the \emph{==} operator to identify missing values in a
dataset. There is a special \textbf{is.na()} function to locate all of
the missing values in a vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1  2 NA  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5 }\OperatorTok{==}\StringTok{ }\OtherTok{NA}    \CommentTok{# this does not do what you want}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{is.na}\NormalTok{( x5 )    }\CommentTok{# much better}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{!}\StringTok{ }\KeywordTok{is.na}\NormalTok{( x5 )  }\CommentTok{# if you want to create a selector vector to drop missing values }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5[ }\OperatorTok{!}\StringTok{ }\KeywordTok{is.na}\NormalTok{(x5) ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x5[ }\KeywordTok{is.na}\NormalTok{(x5) ] <-}\StringTok{ }\DecValTok{0}  \CommentTok{# replace missing values with zero}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-attach-function}{%
\section{The `attach' Function}\label{the-attach-function}}

\textbf{Never Use This!}

This is a convenient function for making variable names easily
accessible, but it is problematic because of:

scope

conflicting variable names

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}
\NormalTok{y <-}\StringTok{ }\DecValTok{6}\OperatorTok{:}\DecValTok{10}

\NormalTok{dat <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(x,y)}

\KeywordTok{rm}\NormalTok{(x)}
\KeywordTok{rm}\NormalTok{(y)}


\CommentTok{# I want to transform x in my dataset}

\KeywordTok{attach}\NormalTok{( dat )}

\DecValTok{2}\OperatorTok{*}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  4  6  8 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{2}\OperatorTok{*}\NormalTok{x}

\KeywordTok{detach}\NormalTok{( dat )}

\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  4  6  8 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat  }\CommentTok{# whoops! I didn't save my work in the dataset}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   x  y
## 1 1  6
## 2 2  7
## 3 3  8
## 4 4  9
## 5 5 10
\end{verbatim}

You will see the \textbf{attach()} function used on occassion, and it is
tempting because you can write the variable names directly. But in
general, try to avoid the \textbf{attach()} function and don't form bad
habits by using it now because when your scripts become more complicated
then can cause problmes.

\hypertarget{merging-data}{%
\chapter{Merging Data}\label{merging-data}}

\hypertarget{packages-used-in-this-chapter}{%
\section{Packages Used in This
Chapter}\label{packages-used-in-this-chapter}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( pander )}
\KeywordTok{library}\NormalTok{( dplyr )}
\KeywordTok{library}\NormalTok{( maps )}
\end{Highlighting}
\end{Shaded}

\hypertarget{relational-databases}{%
\section{Relational Databases}\label{relational-databases}}

Modern databases are huge - think about the amount of information stored
at Amazon in the history of each transation, the database where Google
logs every single search from every person around the world, or
Twitter's database of all of the tweets (millions each day).

When databases become large, flat spreadsheet style formats are not
useful because they create a lot of redundant information, are large to
store, and are not efficient to search. Large datasets are instead
stored in relational databases - sets of tables that contain unique IDs
that allow them to be joined when necessary.

For example, consider a simple customer database. We don't want to store
customer info with our transactions because we would be repeating their
name and street address every time they make a new purchase. As a
result, we store customer information and transaction information
separately.

\begin{longtable}[]{@{}ccccc@{}}
\toprule
\begin{minipage}[b]{0.17\columnwidth}\centering
CUSTOMER.ID\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\centering
FIRST.NAME\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\centering
LAST.NAME\strut
\end{minipage} & \begin{minipage}[b]{0.19\columnwidth}\centering
ADDRESS\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
ZIP.CODE\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.17\columnwidth}\centering
178\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
Alvaro\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
Jaurez\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\centering
123 Park Ave\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
57701\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering
934\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
Janette\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
Johnson\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\centering
456 Candy Ln\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
57701\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\centering
269\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
Latisha\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\centering
Shane\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\centering
1600 Penn Ave\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
20500\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.18\columnwidth}\centering
CUSTOMER.ID\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
PRODUCT\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
PRICE\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.18\columnwidth}\centering
178\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
video\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
5.38\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
178\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
shovel\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
12\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
269\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
book\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
3.99\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
269\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
purse\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
8\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
934\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
mirror\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
7.64\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

If we want to make the information actionable then we need to combine
these datasets. For example, perhaps we want to know the average
purchase amount from an individual in the 57701 zip code. We cannot
answer that question with either dataset since the zip code is in one
dataset, and the price is in another. We need to merge the data.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{merge}\NormalTok{( customer.info, purchases )   }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   CUSTOMER.ID FIRST.NAME LAST.NAME       ADDRESS ZIP.CODE PRODUCT PRICE
## 1         178     Alvaro    Jaurez  123 Park Ave    57701   video  5.38
## 2         178     Alvaro    Jaurez  123 Park Ave    57701  shovel 12.00
## 3         269    Latisha     Shane 1600 Penn Ave    20500    book  3.99
## 4         269    Latisha     Shane 1600 Penn Ave    20500   purse  8.00
## 5         934    Janette   Johnson  456 Candy Ln    57701  mirror  7.64
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{full.dat <-}\StringTok{ }\KeywordTok{merge}\NormalTok{( customer.info, purchases ) }

\KeywordTok{mean}\NormalTok{( full.dat}\OperatorTok{$}\NormalTok{PRICE[ full.dat}\OperatorTok{$}\NormalTok{ZIP.CODE }\OperatorTok{==}\StringTok{ "57701"}\NormalTok{ ] )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.34
\end{verbatim}

In reality, each purchase would have a purchase ID that is linked to
shipping addresses, customer complaints, seller ratings, etc. Each
seller would have their own data table with info. Each purchase would be
tied to a payment type, which has its own data table. The system gets
quite complex, which is why it is important to pay attention to the
details of putting the data back together again.

\includegraphics{figures/SampleRetailDatabase.png}

We will cover a few details of data merges that will help you avoid
common and very subtle mistakes that can lead to incorrect inferences.

\hypertarget{set-theory}{%
\section{Set Theory}\label{set-theory}}

In order to merge data \textbf{correctly} you need to understand some
very basic principles of set theory.

\hypertarget{set-theory-functions}{%
\subsection{Set Theory Functions}\label{set-theory-functions}}

Let's assume we have two sets: set1=\emph{{[}A,B{]}},
set2=\emph{{[}B,C{]}}. Each element in this set represents a group of
observations that occurs in the dataset. So B represents people that
occur in both datasets, A represents people that occur only in the first
dataset, and C represents people that only occur in the second dataset.

We can then describe membership through three operations:

\begin{longtable}[]{@{}ll@{}}
\toprule
Operation & Description\tabularnewline
\midrule
\endhead
union & The universe of all elements across all both sets:
{[}A,B,C{]}\tabularnewline
intersection & The elements shared by both sets: {[}B{]}\tabularnewline
difference & The elements in my first set, not in my second {[}A{]} or
{[}C{]}\tabularnewline
\bottomrule
\end{longtable}

Let's see how this might work in practice with an example of members of
a study:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{name <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"frank"}\NormalTok{,}\StringTok{"wanda"}\NormalTok{,}\StringTok{"sanjay"}\NormalTok{,}\StringTok{"nancy"}\NormalTok{)}
\NormalTok{group <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"treat"}\NormalTok{,}\StringTok{"treat"}\NormalTok{,}\StringTok{"control"}\NormalTok{,}\StringTok{"control"}\NormalTok{)}
\NormalTok{gender <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{)}

\KeywordTok{data.frame}\NormalTok{( name, group, gender ) }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\centering
name\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
group\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\centering
gender\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\centering
frank\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
treat\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
male\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
wanda\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
treat\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
female\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
sanjay\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
male\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
nancy\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\centering
female\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

For this example let's define set 1 as the treatment group, and set 2 as
all women in the study. Note that set membership is always defined as
binary (you are in the set or out), but it can include multiple criteria
(the set of animals can contains cats, dogs, and mice).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{treated <-}\StringTok{ }\NormalTok{name[ group }\OperatorTok{==}\StringTok{ "treat"}\NormalTok{ ]}

\NormalTok{treated }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\emph{frank} and \emph{wanda}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{females <-}\StringTok{ }\NormalTok{name[ gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ ]}

\NormalTok{females }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\emph{wanda} and \emph{nancy}

Now we can specify group belonging using some convenient set theory
functions: \textbf{union()}, \textbf{setdiff()}, and
\textbf{intersect()}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{union}\NormalTok{( treated, females )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "frank" "wanda" "nancy"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{intersect}\NormalTok{( treated, females )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "wanda"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setdiff}\NormalTok{( treated, females )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "frank"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setdiff}\NormalTok{( females, treated )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "nancy"
\end{verbatim}

It is very important to note that \textbf{union()} and
\textbf{intersect()} are symmetric functions, meaning
\emph{intersect(x,y)} will give you the same result as
\emph{intersect(y,x)}. The \textbf{setdiff()} function is not symmetric,
however.

\hypertarget{set-theory-using-logical-operators}{%
\subsection{Set Theory Using Logical
Operators}\label{set-theory-using-logical-operators}}

Typically you will define your groups using logical operators, which
perform the exact same funciton as set theory functions but are a little
more expressive and flexible.

Let's use the same example above where x=``treatment'' and y=``female'',
then consider these cases:

\includegraphics{figures/set_theory.png}

Who belongs in each group?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#   x}

\NormalTok{name[ group }\OperatorTok{==}\StringTok{ "treat"}\NormalTok{ ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "frank" "wanda"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#   x & y}

\NormalTok{name[ group }\OperatorTok{==}\StringTok{ "treat"} \OperatorTok{&}\StringTok{ }\NormalTok{gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "wanda"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#   x & ! y}

\NormalTok{name[ group }\OperatorTok{==}\StringTok{ "treat"} \OperatorTok{&}\StringTok{ }\NormalTok{gender }\OperatorTok{!=}\StringTok{ "female"}\NormalTok{ ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "frank"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#  x | y}

\NormalTok{name[ group }\OperatorTok{==}\StringTok{ "treat"} \OperatorTok{|}\StringTok{ }\NormalTok{gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{ ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "frank" "wanda" "nancy"
\end{verbatim}

Who belongs in these groups?

\begin{itemize}
\tightlist
\item
  !x \& !y
\item
  x \& ! ( x \& y )
\item
  ( x \textbar{} y ) \& ! ( x \& y )
\end{itemize}

\hypertarget{merging-data-1}{%
\section{Merging Data}\label{merging-data-1}}

\textbf{The Merge Function}

The merge function joins two datasets. The function requires two
datasets as the arguments, and they need to share a unique ID variable.
Recall the example from above:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{merge}\NormalTok{( customer.info, purchases )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   CUSTOMER.ID FIRST.NAME LAST.NAME       ADDRESS ZIP.CODE PRODUCT PRICE
## 1         178     Alvaro    Jaurez  123 Park Ave    57701   video  5.38
## 2         178     Alvaro    Jaurez  123 Park Ave    57701  shovel 12.00
## 3         269    Latisha     Shane 1600 Penn Ave    20500    book  3.99
## 4         269    Latisha     Shane 1600 Penn Ave    20500   purse  8.00
## 5         934    Janette   Johnson  456 Candy Ln    57701  mirror  7.64
\end{verbatim}

The important thing to keep in mind is that the default merge operation
uses the \textbf{intersection} of the two datasets. It will drop all
elements that don't occur in both datasets. We may want to fine-tune
this as to not lose valuable data and potentially bias our analysis. As
an example, no illegal immigrants will have social security numbers, so
if you are merging using the SSN, you will drop this group from the
data, which could impact your results.

\includegraphics{figures/xy.png}

With a little help from the set theory examples above, we can think
about which portions of the data we wish to drop and which portions we
wish to keep.

\begin{longtable}[]{@{}ll@{}}
\toprule
Argument & Usage\tabularnewline
\midrule
\endhead
all=F & DEFAULT - new dataset contains intersection of X and Y (B
only)\tabularnewline
all=T & New dataset contains union of X and Y (A, B \& C)\tabularnewline
all.x=T & New dataset contains A and B, not C\tabularnewline
all.y=T & New dataset contains B and C, not A\tabularnewline
\bottomrule
\end{longtable}

Here is some demonstrations with examples adapted from the R help file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{authors   }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       surname nationality deceased
## 1       Tukey          US      yes
## 2     Tierney          US       no
## 3      Ripley          UK       no
## 4      McNeil   Australia       no
## 5 Shakespeare     England      yes
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{books    }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          name                     title
## 1       Tukey Exploratory Data Analysis
## 2    Venables Modern Applied Statistics
## 3      Ripley        Spatial Statistics
## 4      Ripley     Stochastic Simulation
## 5      McNeil Interactive Data Analysis
## 6 R Core Team      An Introduction to R
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# adding books to the author bios dataset  ( set B only )}

\KeywordTok{merge}\NormalTok{(authors, books, }\DataTypeTok{by.x =} \StringTok{"surname"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"name"}\NormalTok{)    }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   surname nationality deceased                     title
## 1  McNeil   Australia       no Interactive Data Analysis
## 2  Ripley          UK       no        Spatial Statistics
## 3  Ripley          UK       no     Stochastic Simulation
## 4   Tukey          US      yes Exploratory Data Analysis
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# adding author bios to the books dataset  ( set B only )}

\KeywordTok{merge}\NormalTok{(books, authors, }\DataTypeTok{by.x =} \StringTok{"name"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"surname"}\NormalTok{)    }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     name                     title nationality deceased
## 1 McNeil Interactive Data Analysis   Australia       no
## 2 Ripley        Spatial Statistics          UK       no
## 3 Ripley     Stochastic Simulation          UK       no
## 4  Tukey Exploratory Data Analysis          US      yes
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# keep books without author bios, lose authors without books  ( sets A and B )}

\KeywordTok{merge}\NormalTok{( books, authors, }\DataTypeTok{by.x =} \StringTok{"name"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"surname"}\NormalTok{, }\DataTypeTok{all.x=}\NormalTok{T )     }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          name                     title nationality deceased
## 1      McNeil Interactive Data Analysis   Australia       no
## 2 R Core Team      An Introduction to R        <NA>     <NA>
## 3      Ripley        Spatial Statistics          UK       no
## 4      Ripley     Stochastic Simulation          UK       no
## 5       Tukey Exploratory Data Analysis          US      yes
## 6    Venables Modern Applied Statistics        <NA>     <NA>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# keep authors without book listed, lose books without author bios   ( sets B and C )}

\KeywordTok{merge}\NormalTok{( books, authors, }\DataTypeTok{by.x =} \StringTok{"name"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"surname"}\NormalTok{, }\DataTypeTok{all.y=}\NormalTok{T )    }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          name                     title nationality deceased
## 1      McNeil Interactive Data Analysis   Australia       no
## 2      Ripley        Spatial Statistics          UK       no
## 3      Ripley     Stochastic Simulation          UK       no
## 4 Shakespeare                      <NA>     England      yes
## 5     Tierney                      <NA>          US       no
## 6       Tukey Exploratory Data Analysis          US      yes
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# dont' throw out any data   ( sets A and B and C )}

\KeywordTok{merge}\NormalTok{( books, authors, }\DataTypeTok{by.x =} \StringTok{"name"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"surname"}\NormalTok{, }\DataTypeTok{all=}\NormalTok{T )   }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          name                     title nationality deceased
## 1      McNeil Interactive Data Analysis   Australia       no
## 2 R Core Team      An Introduction to R        <NA>     <NA>
## 3      Ripley        Spatial Statistics          UK       no
## 4      Ripley     Stochastic Simulation          UK       no
## 5 Shakespeare                      <NA>     England      yes
## 6     Tierney                      <NA>          US       no
## 7       Tukey Exploratory Data Analysis          US      yes
## 8    Venables Modern Applied Statistics        <NA>     <NA>
\end{verbatim}

Also note that the order of your datasets in the argument list will
impact the inclusion or exclusion of elements.

merge( x, y, all=F ) EQUALS merge( y, x, all=F )

merge( x, y, all.x=T ) DOES NOT EQUAL merge( y, x, all.x=T )

\hypertarget{the-by.x-and-by.y-arguments}{%
\subsection{The by.x and by.y
Arguments}\label{the-by.x-and-by.y-arguments}}

When you use the default \textbf{merge()} function without specifying
the variables to merge upon, the function will check for common variable
names across the two datasets. If there are multiple, it will join the
shared variables to create a new unique key. This might be problematic
if that was not the intent.

Take the example of combining fielding and salary data in the Lahman
package. If we are not explicit about the merge variable, we may get odd
results. Note that they two datasets share four ID variables.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( Lahman )}
\KeywordTok{data}\NormalTok{( Fielding )}
\KeywordTok{data}\NormalTok{( Salaries )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{intersect}\NormalTok{( }\KeywordTok{names}\NormalTok{(Fielding), }\KeywordTok{names}\NormalTok{(Salaries) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "playerID" "yearID"   "teamID"   "lgID"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# merge id}

\NormalTok{int <-}\StringTok{ }\KeywordTok{intersect}\NormalTok{( }\KeywordTok{names}\NormalTok{(Fielding), }\KeywordTok{names}\NormalTok{(Salaries) )}

\KeywordTok{paste}\NormalTok{( int[}\DecValTok{1}\NormalTok{],int[}\DecValTok{2}\NormalTok{],int[}\DecValTok{3}\NormalTok{],int[}\DecValTok{4}\NormalTok{], }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "playerID.yearID.teamID.lgID"
\end{verbatim}

To avoid problems, be explicit using the \emph{by.x} and \emph{by.x}
arguments to control which variable is used for the merge.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{( }\KeywordTok{merge}\NormalTok{( Salaries, Fielding ) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   yearID teamID lgID  playerID salary stint POS  G GS InnOuts  PO  A E DP
## 1   1985    ATL   NL barkele01 870000     1   P 20 18     221   2  9 1  0
## 2   1985    ATL   NL bedrost01 550000     1   P 37 37     620  13 23 4  3
## 3   1985    ATL   NL benedbr01 545000     1   C 70 67    1698 314 35 4  1
## 4   1985    ATL   NL  campri01 633333     1   P 66  2     383   7 13 4  3
## 5   1985    ATL   NL ceronri01 625000     1   C 91 76    2097 384 48 6  4
## 6   1985    ATL   NL chambch01 800000     1  1B 39 27     814 299 25 1 31
##   PB WP SB CS ZR
## 1 NA NA NA NA NA
## 2 NA NA NA NA NA
## 3  1  9 65 24  1
## 4 NA NA NA NA NA
## 5  6 20 69 29  1
## 6 NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{( }\KeywordTok{merge}\NormalTok{( Salaries, Fielding, }\DataTypeTok{by.x=}\StringTok{"playerID"}\NormalTok{, }\DataTypeTok{by.y=}\StringTok{"playerID"}\NormalTok{ ) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    playerID yearID.x teamID.x lgID.x  salary yearID.y stint teamID.y
## 1 aardsda01     2010      SEA     AL 2750000     2009     1      SEA
## 2 aardsda01     2010      SEA     AL 2750000     2015     1      ATL
## 3 aardsda01     2010      SEA     AL 2750000     2006     1      CHN
## 4 aardsda01     2010      SEA     AL 2750000     2008     1      BOS
## 5 aardsda01     2010      SEA     AL 2750000     2013     1      NYN
## 6 aardsda01     2010      SEA     AL 2750000     2012     1      NYA
##   lgID.y POS  G GS InnOuts PO A E DP PB WP SB CS ZR
## 1     AL   P 73  0     214  2 5 0  1 NA NA NA NA NA
## 2     NL   P 33  0      92  0 1 1  0 NA NA NA NA NA
## 3     NL   P 45  0     159  1 5 0  1 NA NA NA NA NA
## 4     AL   P 47  0     146  3 6 0  0 NA NA NA NA NA
## 5     NL   P 43  0     119  1 5 0  0 NA NA NA NA NA
## 6     AL   P  1  0       3  0 0 0  0 NA NA NA NA NA
\end{verbatim}

\hypertarget{non-unique-observations-in-id-variables}{%
\section{Non-Unique Observations in ID
Variables}\label{non-unique-observations-in-id-variables}}

In some rare instances, you will need to merge to datasets that have
non-singular elements in the unique key ID variables, meaning each
observation / individual appears more than one time in the data. Note
that in this case, for each occurance of an observation / individual in
your X dataset, you will merge once with each occurance of the same
observation / individual in the Y dataset. The result will be a
multiplicative expansion of the size of your dataset.

For example, if John appears on four separate rows of X, and three
seperate rows of Y, the new dataset will contain 12 rows of John (4 x 3
= 12).

dataset X contains four separate instances of an individual {[} X1, X2,
X3, X4 {]}

dataset Y contains three separate instances of an individual {[} Y1, Y2,
Y3 {]}

After the merge we have one row for each pair:

X1-Y1\\
X1-Y2\\
X1-Y3\\
X2-Y1\\
X2-Y2\\
X2-Y3\\
X3-Y1\\
X3-Y2\\
X3-Y3\\
X4-Y1\\
X4-Y2\\
X4-Y3

For example, perhaps a sales company has a database that keeps track of
biographical data, and sales performance. Perhaps we want to see if
there is peak age for sales performance. We need to merge these
datasets.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bio <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{name=}\KeywordTok{c}\NormalTok{(}\StringTok{"John"}\NormalTok{,}\StringTok{"John"}\NormalTok{,}\StringTok{"John"}\NormalTok{),}
                   \DataTypeTok{year=}\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\NormalTok{,}\DecValTok{2001}\NormalTok{,}\DecValTok{2002}\NormalTok{),}
                   \DataTypeTok{age=}\KeywordTok{c}\NormalTok{(}\DecValTok{43}\NormalTok{,}\DecValTok{44}\NormalTok{,}\DecValTok{45}\NormalTok{) )}

\NormalTok{performance <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{( }\DataTypeTok{name=}\KeywordTok{c}\NormalTok{(}\StringTok{"John"}\NormalTok{,}\StringTok{"John"}\NormalTok{,}\StringTok{"John"}\NormalTok{),}
                           \DataTypeTok{year=}\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\NormalTok{,}\DecValTok{2001}\NormalTok{,}\DecValTok{2002}\NormalTok{),}
                           \DataTypeTok{sales=}\KeywordTok{c}\NormalTok{(}\StringTok{"15k"}\NormalTok{,}\StringTok{"20k"}\NormalTok{,}\StringTok{"17k"}\NormalTok{) )}

\CommentTok{# correct merge}

\KeywordTok{merge}\NormalTok{( bio, performance, }\DataTypeTok{by.x=}\KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{,}\StringTok{"year"}\NormalTok{), }\DataTypeTok{by.y=}\KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{,}\StringTok{"year"}\NormalTok{) ) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   name year age sales
## 1 John 2000  43   15k
## 2 John 2001  44   20k
## 3 John 2002  45   17k
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# incorrect merge}

\KeywordTok{merge}\NormalTok{( bio, performance, }\DataTypeTok{by.x=}\KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{), }\DataTypeTok{by.y=}\KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{) )  }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   name year.x age year.y sales
## 1 John   2000  43   2000   15k
## 2 John   2000  43   2001   20k
## 3 John   2000  43   2002   17k
## 4 John   2001  44   2000   15k
## 5 John   2001  44   2001   20k
## 6 John   2001  44   2002   17k
## 7 John   2002  45   2000   15k
## 8 John   2002  45   2001   20k
## 9 John   2002  45   2002   17k
\end{verbatim}

\textbf{It is good practice to check the size (number of rows) of your
dataset before and after a merge. If it has expanded, chances are you
either used the wrong unique IDs, or your dataset contains duplicates.}

\hypertarget{example-of-incorrect-merge}{%
\subsection{Example of Incorrect
Merge}\label{example-of-incorrect-merge}}

Here is a tangible example using the Lahman baseball dataset. Perhaps we
want to examine the relationship between fielding position and salary.
The \emph{Fielding} dataset contains fielding position information, and
the \emph{Salaries} dataset contains salary information. We can merge
these two datasets using the \emph{playerID} field.

If we are not thoughtful about this, however, we will end up causing
problems. Let's look at an example using Kirby Pucket.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kirby.fielding <-}\StringTok{ }\NormalTok{Fielding[ Fielding}\OperatorTok{$}\NormalTok{playerID }\OperatorTok{==}\StringTok{ "puckeki01"}\NormalTok{ , ]}

\KeywordTok{head}\NormalTok{( kirby.fielding )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        playerID yearID stint teamID lgID POS   G  GS InnOuts  PO  A E DP
## 83848 puckeki01   1984     1    MIN   AL  OF 128 128    3377 438 16 3  4
## 85157 puckeki01   1985     1    MIN   AL  OF 161 160    4213 465 19 8  5
## 86489 puckeki01   1986     1    MIN   AL  OF 160 157    4155 429  8 6  3
## 87896 puckeki01   1987     1    MIN   AL  OF 147 147    3820 341  8 5  2
## 89264 puckeki01   1988     1    MIN   AL  OF 158 157    4049 450 12 3  4
## 90685 puckeki01   1989     1    MIN   AL  OF 157 154    3985 438 13 4  3
##       PB WP SB CS ZR
## 83848 NA NA NA NA NA
## 85157 NA NA NA NA NA
## 86489 NA NA NA NA NA
## 87896 NA NA NA NA NA
## 89264 NA NA NA NA NA
## 90685 NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{( kirby.fielding )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 21
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kirby.salary <-}\StringTok{ }\NormalTok{Salaries[ Salaries}\OperatorTok{$}\NormalTok{playerID }\OperatorTok{==}\StringTok{ "puckeki01"}\NormalTok{ , ]}

\KeywordTok{head}\NormalTok{( kirby.salary )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      yearID teamID lgID  playerID  salary
## 280    1985    MIN   AL puckeki01  130000
## 917    1986    MIN   AL puckeki01  255000
## 1610   1987    MIN   AL puckeki01  465000
## 2244   1988    MIN   AL puckeki01 1090000
## 2922   1989    MIN   AL puckeki01 2000000
## 3717   1990    MIN   AL puckeki01 2816667
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{( kirby.salary )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kirby.field.salary <-}\StringTok{ }\KeywordTok{merge}\NormalTok{( kirby.fielding, kirby.salary, }\DataTypeTok{by.x=}\StringTok{"playerID"}\NormalTok{, }\DataTypeTok{by.y=}\StringTok{"playerID"}\NormalTok{ )}

\KeywordTok{head}\NormalTok{( }\KeywordTok{select}\NormalTok{( kirby.field.salary, yearID.x, yearID.y,   POS,    G,  GS, salary ) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   yearID.x yearID.y POS   G  GS  salary
## 1     1984     1985  OF 128 128  130000
## 2     1984     1986  OF 128 128  255000
## 3     1984     1987  OF 128 128  465000
## 4     1984     1988  OF 128 128 1090000
## 5     1984     1989  OF 128 128 2000000
## 6     1984     1990  OF 128 128 2816667
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{( kirby.field.salary )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 273
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{21}\OperatorTok{*}\DecValTok{13}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 273
\end{verbatim}

What we have done here is taken each year of fielding data, and matched
it to \textbf{every} year of salary data. We can see that we have 21
fielding observations and 13 years of salary data, so our resulting
dataset is 273 observation pairs.

This merge also makes it difficult to answer the question of the
relationship between fielding position and salary if players change
positions over time.

The correct merge in this case would be a merge on a playerID-yearID
pair. We can create a unique key by combining playerID and yearID using
\textbf{paste()}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{( }\KeywordTok{paste}\NormalTok{( kirby.fielding}\OperatorTok{$}\NormalTok{playerID, kirby.fielding}\OperatorTok{$}\NormalTok{yearID, }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "puckeki01.1984" "puckeki01.1985" "puckeki01.1986" "puckeki01.1987"
## [5] "puckeki01.1988" "puckeki01.1989"
\end{verbatim}

But there is a simple solution as the merge function also allows for
multiple variables to be used for a \textbf{merge()} command.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kirby.field.salary <-}\StringTok{ }\KeywordTok{merge}\NormalTok{( kirby.fielding, kirby.salary, }
                            \DataTypeTok{by.x=}\KeywordTok{c}\NormalTok{(}\StringTok{"playerID"}\NormalTok{,}\StringTok{"yearID"}\NormalTok{), }
                            \DataTypeTok{by.y=}\KeywordTok{c}\NormalTok{(}\StringTok{"playerID"}\NormalTok{,}\StringTok{"yearID"}\NormalTok{)   )}

\KeywordTok{nrow}\NormalTok{( kirby.field.salary )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20
\end{verbatim}

\hypertarget{the-in-function}{%
\section{The \%in\% function}\label{the-in-function}}

Since we are talking about intersections and matches, I want to briefly
introduce the \textbf{\%in\%} function. It is a combination of the two.

The \textbf{intersect()} function returns a list of unique matches
between two vectors.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(Salaries)}
\KeywordTok{data}\NormalTok{(Fielding)}
\KeywordTok{intersect}\NormalTok{( }\KeywordTok{names}\NormalTok{(Salaries), }\KeywordTok{names}\NormalTok{(Fielding) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "yearID"   "teamID"   "lgID"     "playerID"
\end{verbatim}

The \textbf{match()} function returns the position of matched elements.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{,}\StringTok{"B"}\NormalTok{)}

\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"B"}\NormalTok{,}\StringTok{"D"}\NormalTok{,}\StringTok{"A"}\NormalTok{,}\StringTok{"F"}\NormalTok{)}

\KeywordTok{match}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  3  1 NA  1
\end{verbatim}

The \textbf{\%in\%} function returns a logical vector, where TRUE
signifies that the element in \emph{y} also occurs in \emph{x}. In other
words, does a specific element in \emph{y} belong to the intersection of
\emph{x},\emph{y}.

This is very useful for creating subsets of data that belong to both
sets.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{)}

\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"B"}\NormalTok{,}\StringTok{"D"}\NormalTok{,}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"F"}\NormalTok{,}\StringTok{"B"}\NormalTok{)}

\NormalTok{y }\OperatorTok{%in%}\StringTok{ }\NormalTok{x }\CommentTok{# does each element of y occur anywhere in x?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE FALSE  TRUE  TRUE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y[ y }\OperatorTok{%in%}\StringTok{ }\NormalTok{x] }\CommentTok{# keep only data that occurs in both}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "B" "A" "B" "B"
\end{verbatim}

\hypertarget{the-match-function}{%
\section{The Match Function}\label{the-match-function}}

Often times we do not need to merge data, we may just need sort data in
one dataset so that it matches the order of another dataset. This is
accomplished using the \textbf{match()} function.

Note that we can rearrange the order of a dataset by referencing the
desired position.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Second"}\NormalTok{,}\StringTok{"Third"}\NormalTok{,}\StringTok{"First"}\NormalTok{)}

\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Second" "Third"  "First"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{) ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "First"  "Second" "Third"
\end{verbatim}

The \textbf{match()} function returns the \emph{positions} of matches of
its \emph{first} vector to the \emph{second} vector listed in the
arguments. Or in other words, the \emph{order} that vector 2 would need
to follow to match vector 1.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{)}

\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"B"}\NormalTok{,}\StringTok{"D"}\NormalTok{,}\StringTok{"A"}\NormalTok{)}

\KeywordTok{cbind}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      x   y  
## [1,] "A" "B"
## [2,] "B" "D"
## [3,] "C" "A"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{match}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  3  1 NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{match}\NormalTok{( y, x) }\CommentTok{# not a symmetric operation!}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2 NA  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# In the y vector:}
\CommentTok{#}
\CommentTok{#  [3]=A}
\CommentTok{#  [1]=B}
\CommentTok{# [NA]=D (no match)}

\NormalTok{order.y <-}\StringTok{ }\KeywordTok{match}\NormalTok{( x, y )}

\NormalTok{y[ order.y ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "A" "B" NA
\end{verbatim}

We can see that \textbf{match()} returns the correct order to put
\emph{y} in so that it matches the order of \emph{x}. In the re-ordered
vector, the first element is the original third element \emph{A}, the
second element is the original first element \emph{B}, and there is no
third element because \emph{D} did not match anything in \emph{x}.

Note the order of arguments in the function:

\begin{quote}
match( data I want to match to , data I need to re-order )
\end{quote}

We can use this position information to re-order \emph{y} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{sample}\NormalTok{( LETTERS[}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{], }\DataTypeTok{size=}\DecValTok{10}\NormalTok{ )}

\NormalTok{y <-}\StringTok{ }\KeywordTok{sample}\NormalTok{( LETTERS[}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{], }\DataTypeTok{size=}\DecValTok{10}\NormalTok{ )}

\KeywordTok{cbind}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       x   y  
##  [1,] "I" "F"
##  [2,] "L" "N"
##  [3,] "O" "E"
##  [4,] "J" "C"
##  [5,] "D" "O"
##  [6,] "N" "G"
##  [7,] "C" "H"
##  [8,] "G" "B"
##  [9,] "K" "M"
## [10,] "E" "K"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{order.y <-}\StringTok{ }\KeywordTok{match}\NormalTok{( x, y )}

\NormalTok{y.new <-}\StringTok{ }\NormalTok{y[ order.y ]}

\KeywordTok{cbind}\NormalTok{( x, y.new )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       x   y.new
##  [1,] "I" NA   
##  [2,] "L" NA   
##  [3,] "O" "O"  
##  [4,] "J" NA   
##  [5,] "D" NA   
##  [6,] "N" "N"  
##  [7,] "C" "C"  
##  [8,] "G" "G"  
##  [9,] "K" "K"  
## [10,] "E" "E"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Note the result if you confuse the order or arguments}

\NormalTok{order.y <-}\StringTok{ }\KeywordTok{match}\NormalTok{( y, x )}

\NormalTok{y.new <-}\StringTok{ }\NormalTok{y[ order.y ]}

\KeywordTok{cbind}\NormalTok{( x, y.new )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       x   y.new
##  [1,] "I" NA   
##  [2,] "L" "G"  
##  [3,] "O" "K"  
##  [4,] "J" "H"  
##  [5,] "D" "E"  
##  [6,] "N" "B"  
##  [7,] "C" NA   
##  [8,] "G" NA   
##  [9,] "K" NA   
## [10,] "E" "M"
\end{verbatim}

This comes in handy when we are matching information between two tables.
For example, in GIS the map regions follow a specific order but your
data does not. Create a color scheme for levels of your data, and then
re-order the colors so they match the correct region on the map. In this
example, we will look at unemployment levels by county.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( maps )}
\KeywordTok{data}\NormalTok{( county.fips )}
\KeywordTok{data}\NormalTok{( unemp )}

\KeywordTok{map}\NormalTok{( }\DataTypeTok{database=}\StringTok{"county"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-92-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# assign a color to each level of unemployment, red = high, gray = medium, blue = low}

\NormalTok{color.function <-}\StringTok{ }\KeywordTok{colorRampPalette}\NormalTok{( }\KeywordTok{c}\NormalTok{(}\StringTok{"steelblue"}\NormalTok{, }\StringTok{"gray70"}\NormalTok{, }\StringTok{"firebrick"}\NormalTok{) )}


\NormalTok{color.vector <-}\StringTok{ }\KeywordTok{cut}\NormalTok{( }\KeywordTok{rank}\NormalTok{(unemp}\OperatorTok{$}\NormalTok{unemp), }\DataTypeTok{breaks=}\DecValTok{7}\NormalTok{, }\DataTypeTok{labels=}\KeywordTok{color.function}\NormalTok{( }\DecValTok{7}\NormalTok{ ) )}

\NormalTok{color.vector <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{( color.vector )}

\KeywordTok{head}\NormalTok{( color.vector )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "#B28282" "#B28282" "#B22222" "#B25252" "#B28282" "#B22222"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# doesn't look quite right}

\KeywordTok{map}\NormalTok{( }\DataTypeTok{database=}\StringTok{"county"}\NormalTok{, }\DataTypeTok{col=}\NormalTok{color.vector, }\DataTypeTok{fill=}\NormalTok{T, }\DataTypeTok{lty=}\DecValTok{0}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-92-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# what went wrong here? }

\CommentTok{# our unemployment data (and thus the color vector) follows a different order}

\KeywordTok{cbind}\NormalTok{( }\DataTypeTok{map.id=}\NormalTok{county.fips}\OperatorTok{$}\NormalTok{fips, }\DataTypeTok{data.id=}\NormalTok{unemp}\OperatorTok{$}\NormalTok{fips, color.vector )[ }\DecValTok{2500}\OperatorTok{:}\DecValTok{2510}\NormalTok{ , ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       map.id  data.id color.vector
##  [1,] "48011" "47149" "#B28282"   
##  [2,] "48013" "47151" "#B22222"   
##  [3,] "48015" "47153" "#B22222"   
##  [4,] "48017" "47155" "#B28282"   
##  [5,] "48019" "47157" "#B28282"   
##  [6,] "48021" "47159" "#B22222"   
##  [7,] "48023" "47161" "#B25252"   
##  [8,] "48025" "47163" "#B3B3B3"   
##  [9,] "48027" "47165" "#B28282"   
## [10,] "48029" "47167" "#B25252"   
## [11,] "48031" "47169" "#B25252"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# place the color vector in the correct order}

\NormalTok{this.order <-}\StringTok{ }\KeywordTok{match}\NormalTok{( county.fips}\OperatorTok{$}\NormalTok{fips, unemp}\OperatorTok{$}\NormalTok{fips )}

\NormalTok{color.vec.ordered <-}\StringTok{ }\NormalTok{color.vector[ this.order ]}

\CommentTok{# colors now match their correct counties}

\KeywordTok{map}\NormalTok{( }\DataTypeTok{database=}\StringTok{"county"}\NormalTok{, }\DataTypeTok{col=}\NormalTok{color.vec.ordered, }\DataTypeTok{fill=}\NormalTok{T, }\DataTypeTok{lty=}\DecValTok{0}\NormalTok{ )}
\KeywordTok{title}\NormalTok{( }\DataTypeTok{main=}\StringTok{"Unemployment Levels by County in 2009"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-92-3.pdf}

Note that elements can be recycled from your \emph{y} vector:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{,}\StringTok{"B"}\NormalTok{)}

\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"B"}\NormalTok{,}\StringTok{"D"}\NormalTok{,}\StringTok{"A"}\NormalTok{,}\StringTok{"F"}\NormalTok{)}

\KeywordTok{cbind}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      x   y  
## [1,] "A" "B"
## [2,] "B" "D"
## [3,] "C" "A"
## [4,] "B" "F"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{match}\NormalTok{( x, y )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  3  1 NA  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{order.y <-}\StringTok{ }\KeywordTok{match}\NormalTok{( x, y )}

\NormalTok{y.new <-}\StringTok{ }\NormalTok{y[ order.y ]}

\KeywordTok{cbind}\NormalTok{( x, y.new )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      x   y.new
## [1,] "A" "A"  
## [2,] "B" "B"  
## [3,] "C" NA   
## [4,] "B" "B"
\end{verbatim}

\hypertarget{analysis-with-groups-in-r}{%
\chapter{Analysis with Groups in R}\label{analysis-with-groups-in-r}}

\hypertarget{packages-used-in-this-chapter-1}{%
\subsection{Packages Used in this
Chapter}\label{packages-used-in-this-chapter-1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{( pander )}
\KeywordTok{library}\NormalTok{( dplyr )}
\KeywordTok{library}\NormalTok{( tidyr )}
\KeywordTok{library}\NormalTok{( reshape2 )}
\KeywordTok{library}\NormalTok{( scales )}
\KeywordTok{library}\NormalTok{( ggplot2 )}
\KeywordTok{library}\NormalTok{( Lahman )}
\end{Highlighting}
\end{Shaded}

\hypertarget{hypothetical-experimental-data}{%
\subsection{Hypothetical Experimental
Data}\label{hypothetical-experimental-data}}

We will demonstrate some functions using this hypothetical dataset:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{( d ) }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccccccc@{}}
\toprule
\begin{minipage}[b]{0.06\columnwidth}\centering
id\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\centering
race\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
blood.type\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\centering
gender\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\centering
age\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\centering
study.group\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\centering
speed\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.06\columnwidth}\centering
1\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
black\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
A\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
32\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
638.3\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\centering
2\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
white\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
A\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
39\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
491.3\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\centering
3\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
white\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
B\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
39\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
614.3\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\centering
4\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
white\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
B\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
30\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
667.5\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\centering
5\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
black\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
B\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
40\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
616.3\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\centering
6\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
white\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
B\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\centering
78\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\centering
311.8\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{group-structure}{%
\section{Group Structure}\label{group-structure}}

The two most important skills as you first learn a data programming
language are:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Translating English phrases into computer code using logical
  statements\\
\item
  Organizing your data into groups
\end{enumerate}

This lecture focuses on efficienty splitting your data into groups, and
then analyzing your data by group.

\hypertarget{what-are-groups}{%
\subsection{What Are Groups?}\label{what-are-groups}}

A group represents a set of elements with identical characteristics -
mice all belong to one group and elephants belong to another. Easy
enough, right?

In data analysis, it is a little more complicated because a group is
defined by a set of features. Each group still represents a set of
elements with identical characteristics, but when we have multiple
features there is a unique group for each combination of features.

The simple way to think about this is that the cross-tab of features
generates a grid (table), and each cell represents a unique group:

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-98-1.pdf}

We might be interested in simple groups (treatment cases versus control
cases), or complex groups (does the treatment effect women and men
differently?).

In previous lectures you have learned to identify a group with a logical
statement, and analyze that group discretely.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{( speed[ study.group }\OperatorTok{==}\StringTok{ "treatment"} \OperatorTok{&}\StringTok{ }\NormalTok{gender}\OperatorTok{==}\StringTok{"female"}\NormalTok{ ] )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 619.4947
\end{verbatim}

In this lecture you will learn to define a group structure, then analyze
all of your data using that structure.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{( speed, }\DataTypeTok{INDEX =} \KeywordTok{list}\NormalTok{( study.group, gender ), }\DataTypeTok{FUN =}\NormalTok{ mean )}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.20\columnwidth}\centering
~\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
male\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.20\columnwidth}\centering
\textbf{control}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
462.9\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
358.2\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
\textbf{treatment}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
619.5\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
503.1\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{main-take-away}{%
\subsection{Main Take-Away}\label{main-take-away}}

R has been designed to do efficient data analysis by defining a group
structure, then quickly applying a function to all unique members.

The base R packages do this with a set of functions in the
\textbf{apply()} family. The \textbf{tapply()} function allows you to
specify an outcome to analyze and a group, then ask for results from a
function.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{( }\DataTypeTok{X=}\NormalTok{speed, }\DataTypeTok{INDEX=}\KeywordTok{list}\NormalTok{( study.group, gender ), }\DataTypeTok{FUN=}\NormalTok{mean ) }
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.20\columnwidth}\centering
~\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
male\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.20\columnwidth}\centering
\textbf{control}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
462.9\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
358.2\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
\textbf{treatment}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
619.5\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
503.1\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

The \textbf{dplyr} package makes this process easier using some simple
verbs and the ``pipe'' operator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat  }\OperatorTok{%>%}\StringTok{  }\KeywordTok{group_by}\NormalTok{( study.group, gender )  }\OperatorTok{%>%}\StringTok{  }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{ave.speed =} \KeywordTok{mean}\NormalTok{(speed) )}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.18\columnwidth}\centering
study.group\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
gender\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
ave.speed\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.18\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
358.2\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
control\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
462.9\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
male\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
503.1\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\centering
treatment\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
female\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
619.5\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{example}{%
\subsection{Example}\label{example}}

Let's think about a study looking at reading speed. The treatment is a
workshop that teaches some speed-reading techniques. In this study we
have data on:

\begin{itemize}
\tightlist
\item
  gender (male,female)
\item
  race (black,white,asian)
\item
  blood.type (A,B)
\item
  age (from 18 to 93)
\end{itemize}

Examining descriptive statistics we can see that reading speed varies by
gender and the treatment group, but not by race or blood type:

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-107-1.pdf}

The question is, how many unique groups can we create with these four
factors?

Each individual factor contains a small number of levels (only 2 or 3 in
this case), which makes the group structure look deceptively simple at
first glance. When we start to examine combinations of factors we see
that group structure can get complicated pretty quickly.

If we look at gender alone, we have two levels: male and female. So we
have two groups. If we look at our study groups alone we have two
groups: treatment and control.

If we look at gender and the study groups together, we now have a 2 x 2
grid, or four unique groups.

If the race factor has three levels, how many unique groups will we have
considering the study design, gender, and race together?

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-108-1.pdf}

We can calculate the size of the grid by multiplying number of levels
for each factor. We see here we have 12 unique groups:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nlevels}\NormalTok{( gender ) }\OperatorTok{*}\StringTok{ }\KeywordTok{nlevels}\NormalTok{( study.group ) }\OperatorTok{*}\StringTok{ }\KeywordTok{nlevels}\NormalTok{( race )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 12
\end{verbatim}

If we add blood type, a factor with two levels (A and B), we now have 24
unique groups:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_grid}\NormalTok{( race }\OperatorTok{+}\StringTok{ }\NormalTok{study.group }\OperatorTok{~}\StringTok{ }\NormalTok{gender }\OperatorTok{+}\StringTok{ }\NormalTok{blood.type) }
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-110-1.pdf}

What about age? It is a continuous variable, so it's a little more
tricky.

We can certainly analyze the relationship between age and speed using
correlation tools.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{( age, speed, }\DataTypeTok{bty=}\StringTok{"n"}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Age"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-111-1.pdf}

But we can also incorporate this independent variable into a group
structure. We can treat each distinct age as a separate group. The ages
in this study range from 18 to 93, so we have 65 distinct ages
represented.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{( }\KeywordTok{factor}\NormalTok{(age), speed, }\DataTypeTok{las=}\DecValTok{2}\NormalTok{, }\DataTypeTok{frame.plot=}\NormalTok{F, }\DataTypeTok{outline=}\NormalTok{F, }\DataTypeTok{main=}\StringTok{"Age"}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{"n"}\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-112-1.pdf}

If we think about the overall group structure, then, we have unique
groups defined by gender, race, blood type, and study design, and
another 65 age groups. So in total we now have 24 x 65 = 1,560 groups!
That is getting complicated.

This group design is problematic for two reasons. From a pragmatic
standpoint, we can't report results from 1,500 groups in a table. From a
more substantive perspective, we although we have 1,500 distinct cells
in our grid, many may not include observations that represent the unique
combination of all factors. So this group design is not very practical.

A similar problem arises if our data includes time. If our data includes
the time of events recorded by hours, days of the week, months, and
years, we can have generate complicated group structures if we try to
analyze every unique combination.

We can simplify our analysis by thinking about age ranges instead of
ages, or in other words by binning our continuous data. If we split it
into five-year ranges, for example, we have gone from 65 distinct ages
to 12 distinct age groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age.group <-}\StringTok{ }\KeywordTok{cut}\NormalTok{( age, }
                  \DataTypeTok{breaks=}\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from=}\DecValTok{20}\NormalTok{,}\DataTypeTok{to=}\DecValTok{80}\NormalTok{,}\DataTypeTok{by=}\DecValTok{5}\NormalTok{),}
                  \DataTypeTok{labels=}\KeywordTok{paste}\NormalTok{( }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from=}\DecValTok{20}\NormalTok{,}\DataTypeTok{to=}\DecValTok{75}\NormalTok{,}\DataTypeTok{by=}\DecValTok{5}\NormalTok{), }\StringTok{"to"}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from=}\DecValTok{25}\NormalTok{,}\DataTypeTok{to=}\DecValTok{80}\NormalTok{,}\DataTypeTok{by=}\DecValTok{5}\NormalTok{) ) )}

\NormalTok{group.structure <-}\StringTok{ }\KeywordTok{formula}\NormalTok{( speed }\OperatorTok{~}\StringTok{ }\NormalTok{age.group )}

\KeywordTok{boxplot}\NormalTok{( group.structure, }\DataTypeTok{las=}\DecValTok{2}\NormalTok{, }\DataTypeTok{frame.plot=}\NormalTok{F, }\DataTypeTok{outline=}\NormalTok{F, }\DataTypeTok{main=}\StringTok{"Age Group"}\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-113-1.pdf}

We have now simplified our analysis from 1,560 to 288 possible groups.
Combinations of groups will also be easier:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{group.structure <-}\StringTok{ }\KeywordTok{formula}\NormalTok{( speed }\OperatorTok{~}\StringTok{ }\NormalTok{gender }\OperatorTok{*}\StringTok{ }\NormalTok{age.group )}

\KeywordTok{boxplot}\NormalTok{( group.structure, }
         \DataTypeTok{las=}\DecValTok{2}\NormalTok{, }\DataTypeTok{frame.plot=}\NormalTok{F, }\DataTypeTok{outline=}\NormalTok{F, }\DataTypeTok{main=}\StringTok{"Age Group by Gender"}\NormalTok{,}
         \DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{"firebrick"}\NormalTok{,}\StringTok{"steelblue"}\NormalTok{), }\DataTypeTok{xaxt=}\StringTok{"n"}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-114-1.pdf}

\hypertarget{analysis-by-group}{%
\section{Analysis by Group}\label{analysis-by-group}}

Let's demonstrate some analysis of groups using the Lahman package and
some \textbf{dplyr} verbs. Let's do some analysis of player salaries
(\emph{Salaries} dataset), and start with a simple group structure -
teams in the National League and time.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Which team has the highest average player salary?
\item
  Which team has the most players paid over \$5 million a season?
\item
  Which team has raised it's pay the most over the past decade?
\end{enumerate}

Let's start by thinking about group structure. We have teams, and we
have seasons. Teams is stored as a factor, and seasons as a numeric
value, so we can consider group for each by counting levels and unique
values:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nlevels}\NormalTok{( Salaries}\OperatorTok{$}\NormalTok{teamID )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 46
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{length}\NormalTok{( }\KeywordTok{unique}\NormalTok{( Salaries}\OperatorTok{$}\NormalTok{yearID ) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 32
\end{verbatim}

So we can potentially calculate 32 x 46 = 1,472 average player salaries.

\hypertarget{highest-ave-player-salary}{%
\subsection{Highest Ave Player Salary}\label{highest-ave-player-salary}}

For our first question, we will select only teams from the National
League. Let's use the most recent year of data to calculate average pay.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{, yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2016}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Ave_Salary =} \KeywordTok{mean}\NormalTok{(salary) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##    teamID Ave_Salary
##    <fct>       <dbl>
##  1 ARI      3363041.
##  2 ATL      2362010.
##  3 CHC      5312678.
##  4 CIN      3066899.
##  5 COL      3413487 
##  6 LAD      6322525.
##  7 MIA      2761222.
##  8 MIL      2292508.
##  9 NYM      4958857.
## 10 PHI      2033793.
## 11 PIT      3706387.
## 12 SDP      3756475.
## 13 SFG      6890151.
## 14 STL      4614629.
## 15 WSN      5448179.
\end{verbatim}

Since the salaries are large, they are a little hard to read. Let's
clean up the table a bit.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries  }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{filter}\NormalTok{( lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{, yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2016}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Ave_Salary=}\KeywordTok{dollar}\NormalTok{( }\KeywordTok{mean}\NormalTok{(salary,}\DataTypeTok{na.rm=}\NormalTok{T) ) ) }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{arrange}\NormalTok{( }\KeywordTok{desc}\NormalTok{(Ave_Salary) ) }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{pander}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cc@{}}
\toprule
\begin{minipage}[b]{0.12\columnwidth}\centering
teamID\strut
\end{minipage} & \begin{minipage}[b]{0.17\columnwidth}\centering
Ave\_Salary\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.12\columnwidth}\centering
SFG\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$6,890,151\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
LAD\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$6,322,525\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
WSN\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$5,448,179\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
CHC\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$5,312,678\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
NYM\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$4,958,857\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
STL\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$4,614,629\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
SDP\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$3,756,475\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
PIT\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$3,706,387\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
COL\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$3,413,487\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$3,363,041\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
CIN\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$3,066,899\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
MIA\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$2,761,222\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$2,362,010\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
MIL\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$2,292,508\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
PHI\strut
\end{minipage} & \begin{minipage}[t]{0.17\columnwidth}\centering
\$2,033,793\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{most-players-paid-over-5-million}{%
\subsection{Most Players Paid Over \$5
Million}\label{most-players-paid-over-5-million}}

This question requires you to utilize a logical statement in order to
translate from the question to code. We need to inspect each salary,
determine whether it is over the \$5m threshold, then count all of the
cases. The operation will look something like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{( Salaries}\OperatorTok{$}\NormalTok{salary }\OperatorTok{>}\StringTok{ }\DecValTok{5000000}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3175
\end{verbatim}

It gets a little trickier when we want to do the operation
simultaneously across groups. Our team group structure is already
defined, so let's define our logical vector and count cases that match:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat.NL <-}\StringTok{ }\KeywordTok{filter}\NormalTok{( Salaries, yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2010} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{droplevels}\NormalTok{()}

\NormalTok{gt}\FloatTok{.5}\NormalTok{m <-}\StringTok{ }\NormalTok{dat.NL}\OperatorTok{$}\NormalTok{salary }\OperatorTok{>}\StringTok{ }\DecValTok{5000000}

\KeywordTok{table}\NormalTok{( dat.NL}\OperatorTok{$}\NormalTok{teamID, gt}\FloatTok{.5}\NormalTok{m )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      gt.5m
##       FALSE TRUE
##   ARI    23    3
##   ATL    21    6
##   CHN    19    8
##   CIN    21    5
##   COL    23    6
##   FLO    23    4
##   HOU    24    4
##   LAN    20    7
##   MIL    25    4
##   NYN    19    9
##   PHI    18   10
##   PIT    27    0
##   SDN    25    1
##   SFN    21    7
##   SLN    19    6
##   WAS    26    4
\end{verbatim}

This solution works, but the table provides too much information. We can
use dply to simplify and format the table nicely for our report:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }
\StringTok{   }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2010} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}
\StringTok{   }\KeywordTok{group_by}\NormalTok{( teamID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{   }\KeywordTok{summarise}\NormalTok{( }\DataTypeTok{gt_five_million =} \KeywordTok{sum}\NormalTok{( salary }\OperatorTok{>}\StringTok{ }\DecValTok{5000000}\NormalTok{ ) ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{   }\KeywordTok{arrange}\NormalTok{( }\KeywordTok{desc}\NormalTok{(gt_five_million) ) }\OperatorTok{%>%}
\StringTok{   }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cc@{}}
\toprule
\begin{minipage}[b]{0.12\columnwidth}\centering
teamID\strut
\end{minipage} & \begin{minipage}[b]{0.24\columnwidth}\centering
gt\_five\_million\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.12\columnwidth}\centering
PHI\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
10\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
NYN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
9\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
CHN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
8\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
LAN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
7\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
SFN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
7\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
6\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
COL\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
6\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
SLN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
6\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
CIN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
5\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
FLO\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
4\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
HOU\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
4\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
MIL\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
4\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
WAS\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
4\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
3\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
SDN\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
1\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\centering
PIT\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\centering
0\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{fielding-positions}{%
\subsection{Fielding Positions}\label{fielding-positions}}

Which fielding position is the highest paid?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{merge}\NormalTok{( Salaries, Fielding ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2016}\NormalTok{ ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{( POS ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Mean_Salary =} \KeywordTok{dollar}\NormalTok{( }\KeywordTok{mean}\NormalTok{(salary) ) ) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cc@{}}
\toprule
\begin{minipage}[b]{0.08\columnwidth}\centering
POS\strut
\end{minipage} & \begin{minipage}[b]{0.18\columnwidth}\centering
Mean\_Salary\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.08\columnwidth}\centering
1B\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$5,570,032\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
2B\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$3,162,075\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
3B\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$3,579,088\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
C\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$2,521,903\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
OF\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$3,546,115\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
P\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$3,401,676\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering
SS\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\centering
\$2,510,833\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{country-of-birth}{%
\subsection{Country of Birth}\label{country-of-birth}}

Which country has produced the highest paid baseball players?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{merge}\NormalTok{( Salaries, Master ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{==}\StringTok{ }\DecValTok{2016}\NormalTok{ ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{( birthCountry ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Mean_Salary =} \KeywordTok{dollar}\NormalTok{( }\KeywordTok{mean}\NormalTok{(salary) ) ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cc@{}}
\toprule
\begin{minipage}[b]{0.20\columnwidth}\centering
birthCountry\strut
\end{minipage} & \begin{minipage}[b]{0.20\columnwidth}\centering
Mean\_Salary\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.20\columnwidth}\centering
Aruba\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$650,000\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Australia\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$523,400\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Brazil\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$1,548,792\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
CAN\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$7,854,167\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Colombia\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$3,125,289\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Cuba\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$5,532,484\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Curacao\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$5,724,167\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
D.R.\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$5,102,318\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Germany\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$511,500\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Japan\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$8,247,012\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Mexico\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$4,617,038\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Netherlands\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$2,425,000\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Nicaragua\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$2,375,000\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
P.R.\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$3,241,378\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Panama\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$2,946,550\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Saudi Arabia\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$522,500\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
South Korea\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$5,326,190\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Taiwan\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$6,750,000\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
USA\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$4,189,640\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
V.I.\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$507,500\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\centering
Venezuela\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\centering
\$4,521,051\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{pay-raises}{%
\subsection{Pay Raises}\label{pay-raises}}

To examine pay raises, we will now use more than one year of data. Since
the question asks about pay raises over the past decade, we will filter
the last ten years of data.

And how since we are looking at patterns over teams and over time, we
need to define a group structure with two variables:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{>}\StringTok{ }\DecValTok{2006} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID, yearID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{mean=} \KeywordTok{dollar}\NormalTok{(}\KeywordTok{mean}\NormalTok{(salary)) ) }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{head}\NormalTok{( }\DecValTok{20}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\centering
teamID\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
yearID\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\centering
mean\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2007\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$1,859,555\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2008\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,364,383\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2009\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,812,141\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2010\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,335,314\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2011\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$1,986,660\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2012\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,733,512\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2013\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,004,400\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2014\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,763,904\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2015\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,034,250\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2016\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,363,041\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2007\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,117,530\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2008\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,412,189\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2009\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,335,385\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2010\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,126,802\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2011\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,346,257\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2012\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,856,205\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2013\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$3,254,501\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2014\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$4,067,042\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2015\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,990,885\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2016\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\centering
\$2,362,010\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

This might seem like an odd format. We might expect something that looks
more like our grid structure:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat.NL <-}\StringTok{ }\KeywordTok{filter}\NormalTok{( Salaries, yearID }\OperatorTok{>}\StringTok{ }\DecValTok{2010} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{droplevels}\NormalTok{()}

\KeywordTok{tapply}\NormalTok{( dat.NL}\OperatorTok{$}\NormalTok{salary, }\DataTypeTok{INDEX=}\KeywordTok{list}\NormalTok{(dat.NL}\OperatorTok{$}\NormalTok{teamID, dat.NL}\OperatorTok{$}\NormalTok{yearID), }\DataTypeTok{FUN=}\NormalTok{mean, }\DataTypeTok{na.rm=}\NormalTok{T ) }\OperatorTok{%>%}\StringTok{ }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccccccc@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\centering
~\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2011\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2012\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2013\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2014\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2015\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\centering
2016\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{ARI}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1986660\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2733512\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3004400\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3763904\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2034250\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3363041\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{ATL}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3346257\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2856205\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3254501\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4067042\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2990885\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2362010\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{CHC}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5312678\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{CHN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5001893\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3392194\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3867989\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2426759\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4138547\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{CIN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2531571\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2935843\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4256178\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3864911\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4187862\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3066899\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{CLE}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4500000\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{COL}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3390310\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2692054\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2976363\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3180117\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3827544\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3413487\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{FLO}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2190154\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{HOU}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2437724\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2332731\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{LAD}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6322525\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{LAN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3472967\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3171453\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6980069\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6781706\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
7441103\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{MIA}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4373259\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1400079\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1549515\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2835688\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2761222\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{MIL}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2849911\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3755921\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3077881\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3748778\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3477586\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2292508\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{NYM}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4958857\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{NYN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4401752\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3457555\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1648278\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3168777\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3870667\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{PHI}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5765879\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5817965\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6533200\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5654530\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4295885\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2033793\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{PIT}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1553345\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2248286\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2752214\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2756357\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3065259\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3706387\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{SDN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1479650\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
1973025\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2342339\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2703061\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4555435\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{SDP}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3756475\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{SFG}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6890151\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{SFN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4377716\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3920689\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5006441\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5839649\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
6100056\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{SLN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3904947\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3939317\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
3295004\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4310464\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4586212\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{STL}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4614629\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{WAS}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2201963\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
2695171\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4548131\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
4399456\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5365085\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering
\textbf{WSN}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\centering
5448179\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Later on we will look at the benefits of ``tidy data'', but the basic
idea is that you can ``facet'' your analysis easily when your groups are
represented as factors instead of arranged as a table. For example, here
is a time series graph that is faceted by teams:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{>}\StringTok{ }\DecValTok{2000} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "AL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID, yearID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Mean_Player_Salary=}\KeywordTok{mean}\NormalTok{(salary) ) ->}\StringTok{ }\NormalTok{t1}

\KeywordTok{qplot}\NormalTok{( }\DataTypeTok{data=}\NormalTok{t1, }\DataTypeTok{x=}\NormalTok{yearID, }\DataTypeTok{y=}\NormalTok{Mean_Player_Salary, }\DataTypeTok{geom=}\KeywordTok{c}\NormalTok{(}\StringTok{"point"}\NormalTok{, }\StringTok{"smooth"}\NormalTok{)  ) }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_wrap}\NormalTok{( }\OperatorTok{~}\StringTok{ }\NormalTok{teamID, }\DataTypeTok{ncol=}\DecValTok{5}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DS4PS-I_files/figure-latex/unnamed-chunk-125-1.pdf}

Now you can quickly see that Detroit is the team that has raised
salaries most aggressively.

If we need to, we can easily convert a tidy dataset into something that
looks like a table using the \textbf{spread()} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{>}\StringTok{ }\DecValTok{2006} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID, yearID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{mean =} \KeywordTok{dollar}\NormalTok{(}\KeywordTok{mean}\NormalTok{(salary)) ) }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{spread}\NormalTok{( }\DataTypeTok{key=}\NormalTok{yearID, }\DataTypeTok{value=}\NormalTok{mean, }\DataTypeTok{sep=}\StringTok{"_"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{select}\NormalTok{( }\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{() }\OperatorTok{%>%}
\StringTok{             }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cccccc@{}}
\toprule
\begin{minipage}[b]{0.09\columnwidth}\centering
teamID\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
yearID\_2007\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
yearID\_2008\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
yearID\_2009\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
yearID\_2010\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
yearID\_2011\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.09\columnwidth}\centering
ARI\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,859,555\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,364,383\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,812,141\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,335,314\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,986,660\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
ATL\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,117,530\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,412,189\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,335,385\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,126,802\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,346,257\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
CHN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,691,494\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,383,179\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,392,360\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,429,963\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,001,893\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
CIN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,210,483\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,647,061\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,198,196\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,760,059\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,531,571\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
COL\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,078,500\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,640,596\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,785,222\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,904,379\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,390,310\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
FLO\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$984,097\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$660,955\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,315,500\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,112,212\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,190,154\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
HOU\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,250,333\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,293,719\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,814,682\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,298,411\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,437,724\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
LAN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,739,811\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,089,260\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,016,584\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,531,778\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,472,967\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
MIL\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,629,130\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,790,948\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,083,942\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,796,837\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,849,911\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
NYN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,841,055\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,593,113\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,334,785\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,800,819\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,401,752\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
PHI\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,980,940\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,495,710\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,185,335\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,068,871\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,765,879\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
PIT\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,427,327\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,872,684\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,872,808\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,294,185\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,553,345\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
SDN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,235,022\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,376,697\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,604,952\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,453,819\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,479,650\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
SFN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,469,964\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,641,190\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,965,230\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,522,905\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,377,716\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
SLN\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,224,529\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,018,923\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,278,830\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,741,630\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,904,947\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.09\columnwidth}\centering
WAS\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,319,554\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,895,207\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,140,286\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,046,667\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,201,963\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Salaries }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{( yearID }\OperatorTok{>}\StringTok{ }\DecValTok{2006} \OperatorTok{&}\StringTok{ }\NormalTok{lgID }\OperatorTok{==}\StringTok{ "NL"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{group_by}\NormalTok{( teamID, yearID ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{mean =} \KeywordTok{dollar}\NormalTok{(}\KeywordTok{mean}\NormalTok{(salary)) ) }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{spread}\NormalTok{( }\DataTypeTok{key=}\NormalTok{teamID, }\DataTypeTok{value=}\NormalTok{mean, }\DataTypeTok{sep=}\StringTok{"_"}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{select}\NormalTok{( }\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{ ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\NormalTok{pander}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}cccccc@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\centering
yearID\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
teamID\_ARI\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
teamID\_ATL\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
teamID\_CHC\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
teamID\_CHN\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\centering
teamID\_CIN\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\centering
2007\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,859,555\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,117,530\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,691,494\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,210,483\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2008\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,364,383\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,412,189\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,383,179\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,647,061\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2009\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,812,141\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,335,385\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,392,360\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,198,196\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2010\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,335,314\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,126,802\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,429,963\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,760,059\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2011\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$1,986,660\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,346,257\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,001,893\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,531,571\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2012\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,733,512\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,856,205\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,392,194\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,935,843\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2013\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,004,400\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,254,501\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,867,989\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,256,178\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2014\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,763,904\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,067,042\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,426,759\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,864,911\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2015\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,034,250\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,990,885\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,138,547\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$4,187,862\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\centering
2016\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,363,041\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$2,362,010\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$5,312,678\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
NA\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\centering
\$3,066,899\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\bibliography{book.bib,packages.bib}


\end{document}
