--- 
title: "Intro to Data Science for the Social Sector"
date: "Updated `r format(Sys.time(), '%B %d, %Y')`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
description: "This is an introductory text to data science designed for social science graduate students in public affairs, nonprofit management, and international development."
---

# Welcome {-}

Placeholder



<!--chapter:end:index.Rmd-->


# (PART) PART I: FOUNDATIONS {-}

Placeholder

# Introduction to R

Placeholder


## Navigation
### Setting Your Working Directory
## Commenting Code
##  Here is some documentation for this script
## Help
## Install Programs (packages)
## Accessing Built-In Datasets in R
### Basic Data Operations
### Using the Lahman Data
### Example Analysis

<!--chapter:end:CH-01-introduction-to-r.Rmd-->


# Functions

Placeholder


## Key Concepts
## Computer Programs as Recipes
## Example Function
## Default Argument Values
## Assignment

<!--chapter:end:CH-02-functions.Rmd-->


# VECTORS {-}

Placeholder


## Key Concepts
## Vectors
## Common Vectors Functions
## The Combine Function
## Casting
## Numeric Vectors
### Integers Are Simple Numeric Vectors
## Character Vectors
### Quotes in Arguments
## Factors
## Logical Vectors
## Generating Vectors
## Variable Transformations
## Missing Values: NA's
## Datasets
### Data Frames
### Matrices
### Lists

<!--chapter:end:CH-03-data-structures.Rmd-->


# Logical Statements

Placeholder


## Key Concepts
## Operators 
## Selector Vectors
## Usefulness of Selector Vectors
## Compound Logical Statements
## NAs in Logical Statements
## Subsets

<!--chapter:end:CH-04-business-logic.Rmd-->


# DATA VERBS {-}

Placeholder


## Packages Used in This Chapter
## Key Concepts
## The **dplyr** Package
## Use **filter()** to Subset Rows
## **select()** Columns
## **arrange()** Sorts Data
## Variable Transforms with **mutate()**
## **rename()** Variables
## **summarize()** Variables

<!--chapter:end:CH-05-data_verbs.Rmd-->


# Descriptive Statistics

Placeholder


## Useful Packages

<!--chapter:end:CH-06-summary-stats.Rmd-->


# Data Recipes

Placeholder


## Packages Used in This Chapter
## Key Concepts
## The Pipe Operator **%>%**
## Building Data Recipes
## Conclusion

<!--chapter:end:CH-07-data_recipes.Rmd-->


# Analysis with Groups

Placeholder


## Packages Used in this Chapter
## Hypothetical Experimental Data
## Group Structure
### What Are Groups?
### Main Take-Away
### Example
## Analysis by Group
### Highest Ave Player Salary
### Most Players Paid Over $5 Million
### Fielding Positions
### Country of Birth
### Pay Raises

<!--chapter:end:CH-08-group-structure.Rmd-->


# DATA VIZ {-}

Placeholder


## Key Concepts
## plot() Arguments
## Titles
## Type of Plot
## Shape of Points
## Size of Points
## Colors
## Looking Ahead

<!--chapter:end:CH-09-plot-basics.Rmd-->


# Customizing Plots

Placeholder


## Key Concepts
## Packages Used in This Chapter
## Layering Approach
## Highlighting Cases
## Visual Hypothesis Testing
## Additional Parameters

<!--chapter:end:CH-10-customized-graphics.Rmd-->


# Custom Plot Example

Placeholder


## Basic Rank Plot
## Creating a Submay Map Rank Plot
## Lines
## Connected Points
## Separate Points and Connecting Lines
## Add Labels
## Add Axes and Title
## Generalizing Code
## Improved Aesthetics

<!--chapter:end:CH-11-custom-graphic-example.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  comment = "###",
  collapse = TRUE,
  cache = TRUE,
  out.width = "90%",
  fig.align = 'center',
  fig.width = 8,
  fig.asp = 0.618,  # 1 / phi
  fig.show = "hold"
)

library( dplyr )
library( pander )
library( stargazer )

options( dplyr.print_min = 6, dplyr.print_max = 6 )
```
# Shiny Widgets



## Setup

Note that to use Shiny widgets as part of your document, you need to create a new R Markdown document, then select Shiny as the template.


## My Investment Portfolio

For this chapter we will create some simulated data to track the financial performance of five stocks over 1,000 weeks using a random walk:

```{r}

# data setup

org1 <- cumsum( rnorm(1000) )
org2 <- cumsum( rnorm(1000) )
org3 <- cumsum( rnorm(1000) )
org4 <- cumsum( rnorm(1000) )
org5 <- cumsum( rnorm(1000) )

dat <- data.frame( A=org1, B=org2, C=org3, D=org4, E=org5 )

ymax <- max( dat )
ymin <- min( dat )


# create an empty plot with the correct dimensions
plot.new()
plot.window( xlim=c(0,1050), ylim=c(ymin,ymax) )

points( dat$A, type="l", col="gray70" )
points( dat$B, type="l", col="gray70" )
points( dat$C, type="l", col="gray70" )
points( dat$D, type="l", col="gray70" )
points( dat$E, type="l", col="gray70" )

axis( side=1, cex.axis=0.7, col="gray", col.axis="gray70" )

title( main="Return on Investment", col.main="gray", cex=1.5 )

text( 1000, dat$A[1000], "A", pos=4, col="gray" )
text( 1000, dat$B[1000], "B", pos=4, col="gray" )
text( 1000, dat$C[1000], "C", pos=4, col="gray" )
text( 1000, dat$D[1000], "D", pos=4, col="gray" )
text( 1000, dat$E[1000], "E", pos=4, col="gray" )


```


## Highlight One Stock

Recall that the subset[] operator accepts various types of inputs. You can specify rows or columns by position (number), filter using a selector vector (TRUE for rows you want to keep, FALSE for rows you want to drop), or you can reference column names directly:

```{r, eval=F}
dat[ , "E" ]
```

Below we assign a column name to the object "this.one" and use it to select a single column of data representing returns from one firm:

```{r, eval=F}
this.one <- "E"
dat[ , this.one ]
```

Once we introduce the widget below, we replace statis code for one specific organization with a widget that allows the user to select an organization, and the value is stored on the **input** object.

```{r, eval=F}
input$orgID <- # user input from the widget
dat[ , input.orgID ]
```


```{r}

plot.new()
plot.window( xlim=c(0,1050), ylim=c(ymin,ymax) )

points( dat$A, type="l", col="gray70" )
points( dat$B, type="l", col="gray70" )
points( dat$C, type="l", col="gray70" )
points( dat$D, type="l", col="gray70" )
points( dat$E, type="l", col="gray70" )

axis( side=1, cex.axis=0.7, col="gray", col.axis="gray70" )

title( main="Return on Investment", col.main="gray", cex=1.5 )

text( 1000, dat$A[1000], "A", pos=4, col="gray" )
text( 1000, dat$B[1000], "B", pos=4, col="gray" )
text( 1000, dat$C[1000], "C", pos=4, col="gray" )
text( 1000, dat$D[1000], "D", pos=4, col="gray" )
text( 1000, dat$E[1000], "E", pos=4, col="gray" )


# highlight one organization

this.one <- "E"

points( dat[,this.one], type="l", col="darkred" )
text( 1000, dat[1000,this.one], label=this.one, pos=4, col="darkred" )

```



## Intro to Shiny Widgets

Shiny apps have two parts: a user interface (page layouts and input functions), and a set of rendering functions that translate R graphics into HTML and javascript elements to create interactive web pages.

* `inputPanel` or `sidebarPanel` creates a panel for the widgets
* `input` functions allow users to specify inputs
* `renderPlot` converts to HTML / javascript

When using Shiny, a global object called "input" will be created, and it stores the input values the user defines in slots created through the `inputId` arguments. For example, below we use "animal" for the `inputID`, so the input values are referenced at `input$animal`.


```{r}

selectInput( 
             inputId='animal', 
             label='Select Animal', 
             choices=c("cat","dog","rat"),
             selected="dog"
           )
    


renderPlot({

    plot.new()
    plot.window( xlim=c(0,10), ylim=c(0,10) )
    box()
    
    text( 5, 5, label=input$animal, cex=4 )  # global object "input"
    
    title( main="My Favorite Animal Is A:", line=-2 )

})

```

 
Add a panel for the widget.

```{r}

inputPanel(
 
     selectInput( inputId='animal1', 
                  label='Select Animal', 
                  choices=c("cat","dog","rat"),
                  selected="dog"
                ),
     
     selectInput( inputId='color', 
                  label='Select Color', 
                  choices=c("steelblue","darkred","orange"),
                  selected="orange"
                ),

     selectInput( inputId='size', 
                  label='Select Size', 
                  choices=c(1,2,3,4,5,6,7,8,9),
                  selected=4
                )  
     
) # end inputPanel



renderPlot({

    plot.new()
    plot.window( xlim=c(0,10), ylim=c(0,10) )
    box()
    
    text( 5, 5, label=input$animal1, cex=as.numeric(input$size), col=input$color )  # global object "input"
    
    title( main="My Favorite Animal Is A:", line=-2 )

})

```
  

## Hide the Code

Use the argument `echo=F` in your chunk header to hide the code when you render the widget in a markdown document.  

```{r, echo=F}


 
selectInput( 
             inputId='animal2', 
             label='Select Animal', 
             choices=c("cat","dog","rat"),
             selected="dog"
           )
    




renderPlot({

    plot.new()
    plot.window( xlim=c(0,10), ylim=c(0,10) )
    box()
    
    text( 5, 5, label=input$animal2, cex=4 )
    
    title( main="My Favorite Animal Is A:", line=-2 )

})

```
     

 
 

   
## Generalize the Input 
 
Instead of writing a list of options manually, we can use R functions to generate an input list for us:

* For character vectors:  `unique( var )`
* For factors: `levels( fac )`
* For column of a data frame: `names( dat )`

```{r}


sidebarPanel(
 
     selectInput( inputId='org', 
                  label='Select Organization', 
                  choices=names(dat),
                  selected="A"
                )
    
) # end sidebarPanel



renderPlot({

    plot.new()
    plot.window( xlim=c(0,10), ylim=c(0,10) )
    box()
    
    text( 5, 5, label=input$org, cex=4 )  # global object "input"
    
    title( main="My Selected Org Is:", line=-2 )

})

```

 
 
 

## Investment Tracker

Now put it all together.

```{r, eval=F}

selectInput( inputId='org2', 
            label='Select Organization', 
            choices=names(dat),
            selected="A"
          )
    

renderPlot({
  
  
    plot.new()
    plot.window( xlim=c(0,1050), ylim=c(ymin,ymax) )
    
    points( dat$A, type="l", col="gray70" )
    points( dat$B, type="l", col="gray70" )
    points( dat$C, type="l", col="gray70" )
    points( dat$D, type="l", col="gray70" )
    points( dat$E, type="l", col="gray70" )
    
    axis( side=1, cex.axis=0.7, col="gray", col.axis="gray70" )
    
    title( main="Return on Investment", col.main="gray", cex=1.5 )
    
    text( 1000, dat$A[1000], "A", pos=4, col="gray" )
    text( 1000, dat$B[1000], "B", pos=4, col="gray" )
    text( 1000, dat$C[1000], "C", pos=4, col="gray" )
    text( 1000, dat$D[1000], "D", pos=4, col="gray" )
    text( 1000, dat$E[1000], "E", pos=4, col="gray" )


    # highlight one organization
    
    points( dat[,input$org2], type="l", col="darkred" )
    text( 1000, dat[1000,input$org2], label=this.one, pos=4, col="darkred" )


})


```



```{r, echo=F}

 
selectInput( inputId='org2', 
            label='Select Stock', 
            choices=names(dat),
            selected="A"
          )





renderPlot({
  
  
    plot.new()
    plot.window( xlim=c(0,1050), ylim=c(ymin,ymax) )
    
    points( dat$A, type="l", col="gray70" )
    points( dat$B, type="l", col="gray70" )
    points( dat$C, type="l", col="gray70" )
    points( dat$D, type="l", col="gray70" )
    points( dat$E, type="l", col="gray70" )
    
    axis( side=1, cex.axis=0.7, col="gray", col.axis="gray70" )
    
    title( main="Historical Financial Performance", col.main="gray", cex=2 )
    
    text( 1000, dat$A[1000], "A", pos=4, col="gray" )
    text( 1000, dat$B[1000], "B", pos=4, col="gray" )
    text( 1000, dat$C[1000], "C", pos=4, col="gray" )
    text( 1000, dat$D[1000], "D", pos=4, col="gray" )
    text( 1000, dat$E[1000], "E", pos=4, col="gray" )


    # highlight one organization
    
    points( dat[,input$org2], type="l", col="darkred" )
    text( 1000, dat[1000,input$org2], label=input$org2, pos=4, col="darkred" )
    text( 50, ymax-5, paste("Return on Investment for Stock",input$org2), col="darkred", pos=4 )


})


```




<!--chapter:end:CH-12-shiny-widgets.Rmd-->


# DATA WRANGLING {-}

Placeholder


## Packages Used in This Chapter
## Relational Databases
## Set Theory
### Set Theory Functions
### Set Theory Using Logical Operators
## Merging Data
## use character columns of names to get sensible sort order
### The by.x and by.y Arguments
## Non-Unique Observations in ID Variables
### Example of Incorrect Merge
## The %in% function
## The Match Function

<!--chapter:end:CH-99-merging-data.Rmd-->

